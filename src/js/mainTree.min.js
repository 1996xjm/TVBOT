import{MainPlot}from"/static/xiaochiPlot/minJS/mainplot.min.js";import{TreeParser}from"/static/xiaochiPlot/minJS/treeParser.min.js";const project_manager_T=`<div id="project-manager-box" @mouseover="showbox" @mouseleave="hidebox">
<div class="row g-3 align-items-center" v-show="isShow">
  <div class="col-auto">
  <button @click="toMyTrees" class="mybutton cuIcon-forwardfill" style="background-color: #66c2a5;width: 85px;height: 30px;">My trees</button>
  </div>
  <div class="col-auto">
    <label for="inputPassword6" class="col-form-label">Project</label>
  </div>
  <div class="col-auto">
    <select class="form-select" v-model="currentProjectIndex" aria-label="Default select example">
  <option :value="index" v-for="(op,index) in projectList" >{{op.projectName}}</option>
  
</select>
  </div>
  <div class="col-auto">
    <label for="inputPassword6" class="col-form-label">Title</label>
  </div>
  <div class="col-auto">
    <input  id="inputPassword6" style="width: 100px;" v-model="treeTitle" class="form-control" >
  </div>
  <div class="col-auto">
  <button @click="save" class="mybutton" style="background-color: #66c2a5;width: 60px;height: 30px;">Save</button>
  </div>
  <div class="col-auto">
  <button @click="isPin = !isPin" class="mybutton" style="background-color: #ffffff;width: 30px;height: 30px;cursor: pointer;"><svg style="cursor: pointer !important;" t="1674964096661" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3238" width="25" height="25"><path d="M631.637333 178.432a64 64 0 0 1 19.84 13.504l167.616 167.786667a64 64 0 0 1-19.370666 103.744l-59.392 26.304-111.424 111.552-8.832 122.709333a64 64 0 0 1-109.098667 40.64l-108.202667-108.309333-184.384 185.237333-45.354666-45.162667 184.490666-185.344-111.936-112.021333a64 64 0 0 1 40.512-109.056l126.208-9.429333 109.44-109.568 25.706667-59.306667a64 64 0 0 1 84.181333-33.28z" :fill="isPin ? '#66c2a5':'#cccccc'" p-id="3239"></path></svg></button>
  </div>
</div>
<span class="cuIcon-unfold" style="color:#66c2a5;font-weight: bold;" v-show="!isShow"></span>
</div>`;class MainTree extends MainPlot{constructor(){super("treefile"),this.styleData.legendBTDragData={x:40,y:40},this.styleData.BTcolorBarDragData={x:700,y:400},this.styleData.legendTreeScaleDragData={x:76,y:-18},this.styleData.currentColorInterpolate="interpolatePurples",this.styleData.collapseCladeList=[],this.styleData.deleteWholeCladeList=[],this.styleData.reverseChildrenList=[];const i=this;this.treeBranchClickFunction=function(r="branch"){return function(e){i.layerPlaneData.isShowLayerInformationHoverBox=!1,console.log(e),e.stopPropagation();var[t]=d3.select(this).data();console.log("branchData",t);let a;switch(r){case"branch":a=t.target;break;case"foldedClade":case"leaf":a=t}i.styleData.currentNodeIndex=a.data.nodeIndex;var l=e.clientX+10;let o=e.clientY+10;window.innerHeight-e.clientY<224&&(o=e.clientY-(224-(window.innerHeight-e.clientY))-10),i.layout_phylotree_context_menu_app.$data.clientX=l,i.layout_phylotree_context_menu_app.$data.clientY=o;e=i.styleData.collapseCladeList.findIndex(e=>e.nodeIndex==a.data.nodeIndex),l=i.layout_phylotree_context_menu_app.$data.btnItemArr.findIndex(e=>"collapseClade"==e.method);console.log("foldCladeMethodIndex",l),i.layout_phylotree_context_menu_app.$data.btnItemArr[l].name=-1!=e?"Unfold this clade":"Fold this clade",a.children||-1!=e?i.layout_phylotree_context_menu_app.$data.btnItemArr[l].show=!0:i.layout_phylotree_context_menu_app.$data.btnItemArr[l].show=!1;l=i.layout_phylotree_context_menu_app.$data.btnItemArr.findIndex(e=>"reverseChildren"==e.method);i.layout_phylotree_context_menu_app.$data.btnItemArr[l].show="children"in a;l=i.layout_phylotree_context_menu_app.$data.btnItemArr.findIndex(e=>"deleteWholeClade"==e.method);i.layout_phylotree_context_menu_app.$data.btnItemArr[l].name=a.children?"Delete the whole clade":"Delete leaf",i.layout_phylotree_context_menu_app.$data.isShowMenu=!0}},this.treeBranchEnterFunction=function(s="branch"){return function(e){let t=d3.select(this);var[a]=t.data();let l;switch(s){case"branch":l=a.target,t.attr("old-stroke",t.attr("stroke")),t.attr("stroke","#fc8d62");break;case"foldedClade":l=a,t.attr("old-stroke",t.attr("stroke")),t.attr("stroke","#fc8d62");break;case"leaf":l=a,t.attr("stroke","#fc8d62")}i.layerPlaneData.layerInformationHoverBoxClientX=e.clientX+20,i.layerPlaneData.layerInformationHoverBoxClientY=e.clientY,i.layerPlaneData.layerInformationHoverBoxTitle="Node information";let o=[{key:"Node ID",value:l.data.uniformNodeId},{key:"Branch length",value:l.data.length},{key:"Leaves count",value:l.leaves().length}];if(l.data.btArr&&0<l.data.btArr.length&&o.push({key:"Bootstrap",value:l.data.btArr.join(", ")}),l.data.otherProperty_L)for(var r in l.data.otherProperty_L)o.push({key:r,value:l.data.otherProperty_L[r]});i.layerPlaneData.layerInformationHoverBoxDataArr=o,i.layerPlaneData.isShowLayerInformationHoverBox=!0}},this.treeBranchleaveFunction=function(a="branch"){return function(e){let t=d3.select(this);switch(a){case"branch":case"foldedClade":t.attr("stroke",t.attr("old-stroke"));break;case"leaf":t.attr("stroke",null)}i.layerPlaneData.isShowLayerInformationHoverBox=!1}},this.treeParser=new TreeParser}creatVueApp(){const c=this;let{xAxis:e,yAxis:t,...a}=this.figureData;this.figureData.data.treefile["select-file"].helpLink="https://1996xjm.github.io/tvbot/user_interface/attribute_main/data.html",this.figureData=a,this.figureData.data.treefile["copy-leavesID"]={type:"button",value:"",event:"viewNodesId",isBGGray:!1,isFresh:!1,iconClass:"cuIcon-copy",helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/data.html"},this.figureData.data.treefile["copy-internalID"]={type:"button",value:"",event:"viewInternalNodesId",isBGGray:!1,isFresh:!1,iconClass:"cuIcon-copy",helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/data.html"},this.figureData.canvas.Margin.left.value=20,this.figureData.leaves={"Circle size":{startAngle:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:360},endAngle:{type:"seq",value:"circleTree"==this.plotType?350:360,isSvgAttr:!0,scaleStep:1,min:0,max:720}},"Text style":{id:"leaves-text-style",switch:{type:"check",value:!0,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:.5,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},"word-italic":{type:"text",value:"",helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/leaves.html"},x:{type:"seq",value:5,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:0,isSvgAttr:!0,scaleStep:.1,min:-1/0,max:1/0}},"Leaves Extension":{id:"leaves-extension",extension:{type:"check",value:!1,isFresh:!0},stroke:{type:"color",value:"#cccccc",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.1,min:0,max:1/0},"stroke-dasharray":{type:"text",value:"3,3",isSvgAttr:!0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},"unrootedTree"==this.plotType&&(this.figureData.leaves["Leaves Extension"].offset={type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}),"normalTree"==this.plotType&&(delete this.figureData.leaves["Circle size"],this.figureData.leaves["Text style"]["text-anchor"]={type:"opt",optionList:["start","middle","end"],value:0,isSvgAttr:!0});this.figureData.branches={"Inward layout":{switch:{type:"check",value:!1,isFresh:!0},innerRadius:{type:"seq",value:200,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}},Branches:{id:"branches-path","link-type":{type:"opt",optionList:{circleTree:["rectangular","linear","elliptical","bezierX","bezierY"],normalTree:["rectangular","rounded rectangular","linear","elliptical","bezierX","bezierY"],unrootedTree:["linear","bezierX","bezierY"]}[this.plotType],value:0,isSvgAttr:!0,helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/branches.html"},"ignore-length":{type:"check",value:!1,isFresh:!0},"show-root":{type:"check",value:!0,isFresh:!0,helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/branches.html"},stroke:{type:"color",value:"#000000",isSvgAttr:!1},"stroke-linecap":{type:"opt",optionList:["butt","round","square"],value:1,isSvgAttr:!0},"stroke-width":{type:"seq",value:1.5,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Branches sorting":{switch:{type:"check",value:!0,isFresh:!0},"sort-by":{type:"opt",optionList:["number of leaves","branch length"],value:0,isSvgAttr:!1},"sort-order":{type:"opt",optionList:["ascending","descending"],value:0,isSvgAttr:!1}},Bootstraps:{id:"bootstraps-text",switch:{type:"check",value:!1,isFresh:!0},type:{type:"opt",optionList:["text","circle","gradient color circle"],value:0,isSvgAttr:!0,helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/branches.html#bootstraps"},"data-source":{type:"opt",optionList:["text","circle"],value:0,isSvgAttr:!0},from:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},to:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"scale-by-factor":{type:"seq",value:1,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"round-decimals":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0,helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/branches.html#bootstraps"},"circle-size":{type:"seq",value:40,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:-12,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:-6,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}},"Color bar":{bootstraps:{type:"button",value:"",iconClass:"cuIcon-similar",event:"chooseColorBar"}}},"unrootedTree"==this.plotType&&delete this.figureData.branches.Branches["show-root"],"circleTree"!=this.plotType&&delete this.figureData.branches["Inward layout"],this.figureData["folded clade"]={"Clade style":{fill:{type:"color",value:"#cccccc",isSvgAttr:!1},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}}},"normalTree"!=this.plotType&&"circleTree"!=this.plotType||(s=c.getAxisControlData("tree-length","x",e=>(e.Tick["scale-by-factor"]={type:"seq",value:1,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},e.Tick.reverseValues={type:"check",value:!1,isFresh:!0},e.Axis.switch.value=!1,e)),this.figureData["length axis"]=s),this.figureData["scale legend"]={"Tree scale":{scale:{type:"seq",value:.01,scaleStep:.001,min:0,max:1/0}},"Scale text":{"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:.5,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:1,isSvgAttr:!0}},"Scale line":{stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:2,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-linecap":{type:"opt",optionList:["butt","round","square"],value:1,isSvgAttr:!0}}},this.figureData["BT legend"]=c.legendObj.getLegendControlData("categoryShapeLegend",e=>(e["Legend title"].text.value="Bootstrap values",e["Legend title"]["text-anchor"].value=0,e)),this.figureData["BT color bar legend"]=c.legendObj.getLegendControlData("colorBarLegend",e=>(e["Legend title"].text.value="Bootstrap values",console.log(e),e)),this.figureData.reset={"Reroot tree":{reset:{type:"button",value:"",event:"resetRerootTree",isFresh:!1,iconClass:"cuIcon-refresh"}},"Reverse children":{reset:{type:"button",value:"",event:"resetReverseChildren",isFresh:!1,iconClass:"cuIcon-refresh"}},"Delete clade":{reset:{type:"button",value:"",event:"resetDeleteClade",isFresh:!1,iconClass:"cuIcon-refresh"}}};var l,o={"modify leaves name":function(e){var{controlData:t,categoryList:a,otherData:l,legendDragData:e}=e;return this.datacheck([""])?{controlData:t,categoryList:a,otherData:l,legendDragData:e}:null},"append leaves name":function(e){var{controlData:t,categoryList:a,otherData:l,legendDragData:e}=e;return this.datacheck([""])?{controlData:t,categoryList:a,otherData:l,legendDragData:e}:null},"append superscript to leaves name":function(e){var{controlData:t,categoryList:a,otherData:l,legendDragData:e}=e;return this.datacheck([""])?{controlData:t,categoryList:a,otherData:l,legendDragData:e}:null},"word italic":function(e){var{controlData:t,categoryList:a,otherData:l,legendDragData:e}=e;return this.datacheck([""])?{controlData:t,categoryList:a,otherData:l,legendDragData:e}:null},"color categories of leaves name":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck([""]))return null;o={color:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}}},legend:c.legendObj.getLegendControlData("baseCategoryLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e))};e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]).filter(e=>null!=e),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.color["Custom color"].switch,r.forEach(e=>{e in o.color["Custom color"]?l[e]=o.color["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.color["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"color categories of branches":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck([""]))return null;o={color:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}}},legend:c.legendObj.getLegendControlData("categoryBranchesLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e.Symbol.spacing.value=30,e.Symbol.size.value=25,delete e.Symbol.fill,delete e.Symbol["fill-opacity"],e))};e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]).filter(e=>null!=e),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.color["Custom color"].switch,r.forEach(e=>{e in o.color["Custom color"]?l[e]=o.color["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.color["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"color block of leaves name":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck([""]))return null;o={color:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"},"color gradient":{type:"button",value:"",iconClass:"cuIcon-similar",event:"chooseColorBar"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Color gradient":{switch:{type:"check",value:!0,isFresh:!0},reverse:{type:"check",value:!1,isFresh:!0}}},block:{block:{"width-type":{type:"opt",optionList:["uniform start and end","from LCA to max length of children","from LCA to uniform end","from branch tip to uniform end"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,min:-1/0,max:1/0,scaleStep:2},width:{type:"seq",value:100,isSvgAttr:!0,min:0,max:1/0,scaleStep:1},"width-offset":{type:"seq",value:0,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:1},padding:{type:"seq",value:0,isSvgAttr:!0,min:0,max:1/0,scaleStep:1},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.1,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-as-fill":{type:"check",value:!1,isFresh:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}},text:{id:`color-block-text-${a}`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:.5,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"fill-as-block":{type:"check",value:!1,isFresh:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},horizontal:{type:"check",value:!1,isFresh:!0},rotate:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:1}}},legend:c.legendObj.getLegendControlData("baseCategoryLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e))},"unrootedTree"==c.plotType&&(console.log("lllll"),o.block={block:{extension:{type:"seq",value:0,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:1},"curve-type":{type:"opt",optionList:["curveCatmullRomClosed","curveCardinalClosed","curveBasisClosed"],value:0,isSvgAttr:!1},"curve-tension":{type:"seq",value:.5,isSvgAttr:!1,min:0,max:1,scaleStep:.1}},text:{id:`color-block-text-${a}`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:.5,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"fill-as-block":{type:"check",value:!1,isFresh:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:5,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},o.color["Color gradient"].reverse.value=!0),"normalTree"==c.plotType&&(o.block.block.rx={type:"seq",value:0,isSvgAttr:!0,min:0,max:1/0,scaleStep:1},o.block.block.ry={type:"seq",value:0,isSvgAttr:!0,min:0,max:1/0,scaleStep:1});e=(a,l)=>{r=[],a.forEach(e=>{let t=l?e[a.columns[l.layerDataColumnsIndex[0]]]:e[a.columns[this.currentChenkedColumns[0]]];null!=t&&r.push(t.toString())}),r=Array.from(new Set(r)),console.log("99jjj",r),l&&(l.categoryList=r);let t={};t.switch=o.color["Custom color"].switch,r.forEach(e=>{e in o.color["Custom color"]?t[e]=o.color["Custom color"][e]:t[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.color["Custom color"]=t};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"add symbol":function(e){let{dataSource:t,idSuffix:a,controlData:r,categoryList:s,otherData:l,legendDragData:o}=e;if(!this.datacheck(this.currentChenkedColumns.map(e=>"")))return null;r={background:{Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},symbol:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Symbol type":{},"Symbol color":{switch:{type:"check",value:!1,isFresh:!0}},"Symbol position":{align:{type:"check",value:!1,isFresh:!0},"canvas-width":{type:"seq",value:50*(this.currentChenkedColumns.length-1),isSvgAttr:!1,scaleStep:1,min:0,max:1/0},padding:{type:"seq",value:.3,isSvgAttr:!1,scaleStep:.1,min:0,max:1},offset:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}},"Symbol style":{size:{type:"seq",value:40,isSvgAttr:!1,scaleStep:1,min:30,max:1/0},stroke:{type:"color",value:"#000000",isSvgAttr:!1},"stroke-width":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},legend:c.legendObj.getLegendControlData("categoryShapeLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e))},"unrootedTree"==c.plotType&&(delete r.symbol["Symbol position"].align,delete r.background);e=(a,e)=>{s=[];let t=e?e.layerDataColumnsIndex.map(e=>a.columns[e]):this.currentChenkedColumns.map(e=>a.columns[e]);t.forEach(t=>{a.forEach(e=>{null!=e[t]&&s.push(e[t])})}),s=Array.from(new Set(s)),e&&(e.categoryList=s);let l={},o={};l.switch=r.symbol["Symbol color"].switch,s.forEach(e=>{e in r.symbol["Symbol color"]?l[e]=r.symbol["Symbol color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1},e in r.symbol["Symbol type"]?o[e]=r.symbol["Symbol type"][e]:o[e]={type:"opt",optionList:["symbolCircle-fill","symbolCircle-nofill","symbolCross-fill","symbolCross-nofill","symbolDiamond-fill","symbolDiamond-nofill","symbolSquare-fill","symbolSquare-nofill","symbolStar-fill","symbolStar-nofill","symbolTriangle-fill","symbolTriangle-nofill","symbolWye-fill","symbolWye-nofill","symbolDiamond2-fill","symbolDiamond2-nofill","symbolAsterisk-nofill","symbolPlus-nofill","symbolX-nofill"],value:0,isSvgAttr:!1}}),r.symbol["Symbol color"]=l,r.symbol["Symbol type"]=o};return e(t),l.updateFunction=e,{controlData:r,categoryList:s,otherData:l,legendDragData:o}},"pie chart":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck(this.currentChenkedColumns.map(e=>"number")))return null;o={pie:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Pie style":{id:`pie-path-style-${a}`,"position-type":{type:"opt",optionList:["uniform","at the end of branch","in the middle of branch"],value:0,isSvgAttr:!0},"x-offset":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},innerRadius:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"radius-offset":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#ffffff",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},legend:c.legendObj.getLegendControlData("categoryArcLegend",a,e=>(e["Legend title"].text.value="ChiPlot",e))};e=(t,e)=>{let a=e?e.layerDataColumnsIndex:this.currentChenkedColumns;r=a.map(e=>t.columns[e]),e&&(e.categoryList=r);let l={};l.switch=o.pie["Custom color"].switch,r.forEach(e=>{e in o.pie["Custom color"]?l[e]=o.pie["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.pie["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"branch pie chart":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck(this.currentChenkedColumns.map(e=>"number")))return null;o={pie:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Pie style":{id:`pie-path-style-${a}`,"position-type":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},"x-offset":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"y-offset":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},innerRadius:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},outerRadius:{type:"seq",value:20,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#ffffff",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},legend:c.legendObj.getLegendControlData("categoryArcLegend",a,e=>(e["Legend title"].text.value="ChiPlot",e))};e=(t,e)=>{let a=e?e.layerDataColumnsIndex:this.currentChenkedColumns;r=a.map(e=>t.columns[e]),e&&(e.categoryList=r);let l={};l.switch=o.pie["Custom color"].switch,r.forEach(e=>{e in o.pie["Custom color"]?l[e]=o.pie["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.pie["Custom color"]=l};e(t);let i={};return c.treeHierarchy.descendants().forEach(e=>{i[e.data.nodeIndex]={x:0,y:0}}),l.pieDragData=i,l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"base bar plot":function(e){let{dataSource:t,idSuffix:a,controlData:l,categoryList:o,otherData:r,legendDragData:s}=e;return this.datacheck(["number"])?(r.maxValue=d3.max(t,e=>e[t.columns[this.currentChenkedColumns[0]]]),console.log(r),l.canvas={"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},l.xAxis=c.getAxisControlData(a),l.background={Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},l.bar={"Bar style":{id:`bar-rect-style-${a}`,padding:{type:"seq",value:.3,isSvgAttr:!1,scaleStep:.01,min:0,max:1},fill:{type:"color",value:"#cccccc",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Bar text":{id:`bar-text-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},align:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"value-format":{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"}}},"circleTree"==c.plotType&&(delete l.bar["Bar text"]["text-anchor"],l.bar["Bar text"].x.isSvgAttr=!1),{controlData:l,categoryList:o,otherData:r,legendDragData:s}):null},"bar plot with category":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck(["string","number"]))return null;l.maxValue=d3.max(t,e=>e[t.columns[this.currentChenkedColumns[1]]]),console.log(l),o.canvas={"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},o.xAxis=c.getAxisControlData(a),o.background={Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},o.bar={"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Bar style":{id:`bar-rect-style-${a}`,padding:{type:"seq",value:.3,isSvgAttr:!1,scaleStep:.01,min:0,max:1},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Bar text":{id:`bar-text-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},align:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"value-format":{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"}}},o.legend=c.legendObj.getLegendControlData("baseCategoryLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e)),"circleTree"==c.plotType&&(delete o.bar["Bar text"]["text-anchor"],o.bar["Bar text"].x.isSvgAttr=!1);e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]).filter(e=>null!=e),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.bar["Custom color"].switch,r.forEach(e=>{e in o.bar["Custom color"]?l[e]=o.bar["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.bar["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"base lollipop plot":function(e){let{dataSource:t,idSuffix:a,controlData:l,categoryList:o,otherData:r,legendDragData:s}=e;return this.datacheck(["number"])?(r.maxValue=d3.max(t,e=>e[t.columns[this.currentChenkedColumns[0]]]),console.log(r),l.canvas={"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},l.xAxis=c.getAxisControlData(a),l.background={Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},l.lollipop={"Lollipop style":{id:`bar-rect-style-${a}`,r:{type:"seq",value:8,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#69b3a2",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Lollipop size":{switch:{type:"check",value:!0,isFresh:!0},"min-radius":{type:"seq",value:4,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"max-radius":{type:"seq",value:20,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}},"Line style":{id:`lollipop-line-style-${a}`,stroke:{type:"color",value:"#999999",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"stroke-dasharray":{type:"text",value:"",isSvgAttr:!0}},"Lollipop text":{id:`bar-text-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"value-format":{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"}}},"circleTree"==c.plotType&&(l.lollipop["Lollipop text"].x.isSvgAttr=!1),{controlData:l,categoryList:o,otherData:r,legendDragData:s}):null},"lollipop plot with category":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck(["","number"]))return null;console.log(l),o.canvas={"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},o.xAxis=c.getAxisControlData(a),o.background={Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},o.lollipop={"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Lollipop color":{switch:{type:"check",value:!1,isFresh:!0}},"Lollipop style":{id:`bar-rect-style-${a}`,r:{type:"seq",value:8,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Lollipop size":{switch:{type:"check",value:!0,isFresh:!0},"min-radius":{type:"seq",value:4,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"max-radius":{type:"seq",value:20,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}},"Line style":{id:`lollipop-line-style-${a}`,stroke:{type:"color",value:"#999999",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"stroke-dasharray":{type:"text",value:"",isSvgAttr:!0}},"Lollipop text":{id:`bar-text-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"value-format":{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"}}},o.legend=c.legendObj.getLegendControlData("baseCategoryLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e)),"circleTree"==c.plotType&&(o.lollipop["Lollipop text"].x.isSvgAttr=!1);e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]).filter(e=>null!=e),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.lollipop["Lollipop color"].switch,r.forEach(e=>{e in o.lollipop["Lollipop color"]?l[e]=o.lollipop["Lollipop color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.lollipop["Lollipop color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"stacked bar plot":function(e){let{dataSource:t,idSuffix:a,controlData:l,categoryList:o,otherData:r,legendDragData:s}=e;if(!this.datacheck(this.currentChenkedColumns.map(e=>"number")))return null;l={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(a),background:{Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},bar:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"},"color gradient":{type:"button",value:"",iconClass:"cuIcon-similar",event:"chooseColorBar"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Bar style":{id:`stacked-bar-${a}`,padding:{type:"seq",value:.3,isSvgAttr:!1,scaleStep:.01,min:0,max:1},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},legend:c.legendObj.getLegendControlData("baseCategoryLegend",a,e=>(e["Legend title"].text.value="chiplot",e))};e=(t,e)=>{o=e?e.layerDataColumnsIndex.map(e=>t.columns[e]):this.currentChenkedColumns.map(e=>t.columns[e]),console.log("99jjj",o),e&&(e.categoryList=o);let a={};a.switch=l.bar["Custom color"].switch,o.forEach(e=>{e in l.bar["Custom color"]?a[e]=l.bar["Custom color"][e]:a[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),l.bar["Custom color"]=a};return e(t),r.updateFunction=e,{controlData:l,categoryList:o,otherData:r,legendDragData:s}},"base box plot":function(e){var{idSuffix:t,categoryList:a,otherData:l,legendDragData:e}=e;return this.datacheck(this.currentChenkedColumns.map(e=>"number"))?{controlData:{canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(t),background:{Background:{id:`background-rect-style-${t}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},box:{"Box style":{id:`bar-rect-style-${t}`,padding:{type:"seq",value:.3,isSvgAttr:!1,scaleStep:.01,min:0,max:1},fill:{type:"color",value:"#cccccc",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!1},"stroke-as-box":{type:"check",value:!1,isFresh:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},rx:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},ry:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}}},point:{"Point style":{id:`distribution-point-circle-${t}`,switch:{type:"check",value:!1,isFresh:!0},r:{type:"seq",value:4,isSvgAttr:!0,scaleStep:1,min:1,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"fill-as-box":{type:"check",value:!1,isFresh:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}}},categoryList:a,otherData:l,legendDragData:e}:null},"box plot with category":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e,i=this.currentChenkedColumns.map(e=>"number");if(i[0]="",!this.datacheck(i))return null;o={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(a),background:{Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},box:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Box style":{id:`bar-rect-style-${a}`,padding:{type:"seq",value:.3,isSvgAttr:!1,scaleStep:.01,min:0,max:1},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!1},"stroke-as-box":{type:"check",value:!1,isFresh:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},rx:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},ry:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}}},point:{"Point style":{id:`distribution-point-circle-${a}`,switch:{type:"check",value:!1,isFresh:!0},r:{type:"seq",value:4,isSvgAttr:!0,scaleStep:1,min:1,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"fill-as-box":{type:"check",value:!1,isFresh:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},legend:c.legendObj.getLegendControlData("categoryBoxLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e))};e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]).filter(e=>null!=e),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.box["Custom color"].switch,r.forEach(e=>{e in o.box["Custom color"]?l[e]=o.box["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.box["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},heatmap:function(e){let{idSuffix:t,controlData:a,categoryList:l,otherData:o,legendDragData:r}=e;return this.datacheck(this.currentChenkedColumns.map(e=>"number"))?(a={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(t),cell:{"Color bar":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColorBar"},"custom-color":{type:"check",value:!1,isFresh:!0},"gradient-type":{type:"opt",optionList:["start-end","start-middle-end"],value:0,isSvgAttr:!1},start:{type:"color",value:"#81C7C1",isSvgAttr:!1},middle:{type:"color",value:"#ffffff",isSvgAttr:!1},end:{type:"color",value:"#FC7956",isSvgAttr:!1}},"Cell style":{notFillZero:{type:"check",value:!1,isFresh:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Cell text":{switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0}}},legend:c.legendObj.getLegendControlData("colorBarLegend",t,e=>e)},a.xAxis.Tick.removePath.value=!0,a.xAxis["Text style"].rotate.value="normalTree"==c.plotType?-90:90,a.xAxis["Text style"]["text-anchor"].value="normalTree"==c.plotType?0:2,{controlData:a,categoryList:l,otherData:o,legendDragData:r}):null},"binary type 1":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck(this.currentChenkedColumns.map(e=>"number")))return null;o={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(a),background:{Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},cell:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Cell style":{id:`cell-circle-style-${a}`,"symbol-type":{type:"opt",optionList:c.symbolGenerator.symbolTypeArr,value:0,isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"stroke-width":{type:"seq",value:1.5,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"size-rate":{type:"seq",value:.9,isSvgAttr:!1,scaleStep:.01,min:0,max:1}}}},o.xAxis.Tick.removePath.value=!0,o.xAxis["Text style"].rotate.value="normalTree"==c.plotType?-90:90,o.xAxis["Text style"]["text-anchor"].value="normalTree"==c.plotType?0:2;e=(t,e)=>{let a=e?e.layerDataColumnsIndex:this.currentChenkedColumns;r=a.map(e=>t.columns[e]),e&&(e.categoryList=r);let l={};l.switch=o.cell["Custom color"].switch,r.forEach(e=>{e in o.cell["Custom color"]?l[e]=o.cell["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.cell["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"binary type 2":function(e){let{idSuffix:t,controlData:a,categoryList:l,otherData:o,legendDragData:r}=e;return this.datacheck(this.currentChenkedColumns.map(e=>"number"))?(a={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(t),cell:{"Cell style":{id:`cell-circle-style-${t}`,fill:{type:"color",value:"#7adfe6",isSvgAttr:!1},stroke:{type:"color",value:"#ffffff",isSvgAttr:!0},"stroke-width":{type:"seq",value:1.5,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0},present:{type:"color",value:"#a57ae6",isSvgAttr:!0},absent:{type:"color",value:"#ffffff",isSvgAttr:!0}},"Cell text":{id:`cell-text-style-${t}`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0}}},legend:c.legendObj.getLegendControlData("baseCategoryLegend",t,e=>(delete e.Square["fill-opacity"],e["Text content"]={1:{type:"text",value:"present",isSvgAttr:!0},0:{type:"text",value:"absent",isSvgAttr:!0}},e))},a.xAxis.Tick.removePath.value=!0,a.xAxis["Text style"].rotate.value="normalTree"==c.plotType?-90:90,a.xAxis["Text style"]["text-anchor"].value="normalTree"==c.plotType?0:2,{controlData:a,categoryList:l,otherData:o,legendDragData:r}):null},"bubble plot":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(!this.datacheck(this.currentChenkedColumns.map(e=>"number")))return null;o={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(a),background:{Background:{id:`background-rect-style-${a}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},bubble:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Pure color":{switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#cccccc",isSvgAttr:!0}},"Bubble style":{id:`cell-circle-style-${a}`,"symbol-type":{type:"opt",optionList:c.symbolGenerator.symbolTypeArr,value:0,isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#4d4d4d",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Bubble size":{"min-radius":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"max-radius":{type:"seq",value:2,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}}},legend:c.legendObj.getLegendControlData("baseSizeLegend",e=>(e["Legend title"].text.value="Bubble Size",e))};e=c.getMaxMinValue(t,this.currentChenkedColumns.map(e=>t.columns[e])),e=(e[1]-e[0])/5,e=Number(d3.format(".1r")(e));o.legend["Symbol style"]["range-step"].value=e,o.xAxis.Tick.removePath.value=!0,o.xAxis["Text style"].rotate.value="normalTree"==c.plotType?-90:90,o.xAxis["Text style"]["text-anchor"].value="normalTree"==c.plotType?0:2;e=(t,e)=>{let a=e?e.layerDataColumnsIndex:this.currentChenkedColumns;r=a.map(e=>t.columns[e]),e&&(e.categoryList=r);let l={};l.switch=o.bubble["Custom color"].switch,r.forEach(e=>{e in o.bubble["Custom color"]?l[e]=o.bubble["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.bubble["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"text map":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;o={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(a),text:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Text style":{id:`text-circle-style-${a}`,"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0}}}},o.xAxis.Tick.removePath.value=!0,"circleTree"==c.plotType&&(o.xAxis["Text style"].rotate.value=90,o.xAxis["Text style"]["text-anchor"].value=2);e=(t,e)=>{let a=e?e.layerDataColumnsIndex:this.currentChenkedColumns;r=a.map(e=>t.columns[e]),e&&(e.categoryList=r);let l={};l.switch=o.text["Custom color"].switch,r.forEach(e=>{e in o.text["Custom color"]?l[e]=o.text["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.text["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"text map with category":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(1<!this.currentChenkedColumns.length)return null;o={canvas:{"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},xAxis:c.getAxisControlData(a),text:{"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Text style":{id:`text-circle-style-${a}`,"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0}}}},o.xAxis.Tick.removePath.value=!0,"circleTree"==c.plotType&&(o.xAxis["Text style"].rotate.value=90,o.xAxis["Text style"]["text-anchor"].value=2),o.legend=c.legendObj.getLegendControlData("baseCategoryLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[0]],e));e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]).filter(e=>null!=e),r=Array.from(new Set(r)),a&&(a.categoryList=r);let l={};l.switch=o.text["Custom color"].switch,r.forEach(e=>{e in o.text["Custom color"]?l[e]=o.text["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.text["Custom color"]=l};return e(t),l.updateFunction=e,{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"branch text label":function(e){let{idSuffix:t,controlData:a,categoryList:l,otherData:o,legendDragData:r}=e;if(!this.datacheck([""]))return null;a={text:{"Text style":{id:`branch-text-style-${t}`,"position-type":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#ffffff",isSvgAttr:!1},"stroke-width":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}}}};let s={};return c.treeHierarchy.descendants().forEach(e=>{s[e.data.nodeIndex]={x:0,y:0}}),o.textDragData=s,{controlData:a,categoryList:l,otherData:o,legendDragData:r}},"link between two nodes":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(this.currentChenkedColumns.length<2||3<this.currentChenkedColumns.length)return null;let i={};c.root.leaves().forEach(e=>{i[e.data.name]={}});let n=[];return t.forEach(e=>{i[e.source]&&i[e.target]||n.push(e[t.columns[0]])}),0<n.length&&c.showYesOrNoMessageBox("Data contains invalid links!",`
<h6 style="text-align: center;color: red;" >Node IDs in the following links don't exist in the tree:</h6>
<div style="width: 98%;height: 120px;overflow-y: scroll;word-break: break-all;">${n.join(",")}</div>
`),o.link={"Link style":{"link-type":{type:"opt",optionList:["elliptical","linear"],value:0,isSvgAttr:!1},offset:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},"Link color":{"color-type":{type:"opt",optionList:["source-target","pure"],value:0,isSvgAttr:!1},source:{type:"color",value:"#81C7C1",isSvgAttr:!1},target:{type:"color",value:"#FC7956",isSvgAttr:!1},pure:{type:"color",value:"#4b4b4b",isSvgAttr:!1}}},"normalTree"==c.plotType&&(o.link["Link style"]["offset-x"]={type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}),2<this.currentChenkedColumns.length&&(o.link["Color categories"]={switch:{type:"check",value:!0,isFresh:!0}},o.legend=c.legendObj.getLegendControlData("categoryLineLegend",a,e=>(e["Legend title"].text.value=t.columns[this.currentChenkedColumns[2]],e)),(e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[2]]]:e[t.columns[this.currentChenkedColumns[2]]]).filter(e=>null!=e),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.link["Color categories"].switch,r.forEach(e=>{e in o.link["Color categories"]?l[e]=o.link["Color categories"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.link["Color categories"]=l})(t),l.updateFunction=e),{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"geologic time scale":function(e){let{dataSource:t,idSuffix:a,controlData:o,categoryList:r,otherData:l,legendDragData:s}=e;if(3!=this.currentChenkedColumns.length)return null;o.period={Position:{offset:{type:"seq",value:30,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}},"Color set":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Period style":{id:`Period-rect-${a}`,height:{type:"seq",value:30,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.1,min:0,max:1}},"Text style":{id:`Period-text-style-${a}`,fill:{type:"color",value:"#000000",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0}}};e=(t,a)=>{r=t.map(e=>a?e[t.columns[a.layerDataColumnsIndex[0]]]:e[t.columns[this.currentChenkedColumns[0]]]),r=Array.from(new Set(r)),console.log("99jjj",r),a&&(a.categoryList=r);let l={};l.switch=o.period["Custom color"].switch,r.forEach(e=>{e in o.period["Custom color"]?l[e]=o.period["Custom color"][e]:l[e]={type:"color",value:"#cccccc",isSvgAttr:!1}}),o.period["Custom color"]=l};return e(t),l.updateFunction=e,l.dragData={x:0,y:0},{controlData:o,categoryList:r,otherData:l,legendDragData:s}},"recombination fragment map":function(e){let{idSuffix:t,controlData:a,categoryList:l,otherData:o,legendDragData:r}=e;return this.currentChenkedColumns.length<3||4<this.currentChenkedColumns.length?null:(a.canvas={"Canvas scale":{width:{type:"seq",value:200,isSvgAttr:!1,scaleStep:1,min:1,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}}},a.xAxis=c.getAxisControlData(t),a.background={Background:{id:`background-rect-style-${t}`,switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#e6e6e6",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},{controlData:a,categoryList:l,otherData:o,legendDragData:r})}};let r=["modify leaves name","append leaves name","append superscript to leaves name","word italic","color categories of leaves name","color categories of branches","color block of leaves name","add symbol","branch text label"];for(l in o)"unrootedTree"==c.plotType&&!r.includes(l)||this.layerComponent.addLayerType(l,o[l]);super.creatVueApp(),this.handleClickMethods.resetRerootTree=()=>{console.log("resetRerootTree"),this.styleData.rootNodeIndex=void 0,this.reRootTree(this.styleData.rootNodeIndex,this.styleData.rootOffsetRate)},this.handleClickMethods.resetReverseChildren=()=>{console.log("resetReverseChildren"),this.styleData.reverseChildrenList=[],this.reRootTree(this.styleData.rootNodeIndex,this.styleData.rootOffsetRate)},this.handleClickMethods.resetDeleteClade=()=>{console.log("resetDeleteClade"),this.styleData.deleteWholeCladeList=[],this.reRootTree(this.styleData.rootNodeIndex,this.styleData.rootOffsetRate)},this.handleClickMethods.viewNodesId=e=>{this.copyText(this.root.leaves().map(e=>e.data.name).join("\n")),this.showMessageBox()},this.handleClickMethods.viewInternalNodesId=e=>{this.copyText(this.root.descendants().filter(e=>e.children).map(e=>e.data.uniformNodeId).join("\n")),this.showMessageBox()},this.layout_phylotree_context_menu_app=Vue.createApp({data(){return{clientX:0,clientY:0,isShowMenu:!1,offsetRate:.5,btnItemArr:[{method:"collapseClade",name:"Fold this clade",icon:"cuIcon-fold",show:!0},{method:"reverseChildren",name:"Reverse children",icon:"cuIcon-order",show:!0},{method:"deleteWholeClade",name:"Delete the whole clade",icon:"cuIcon-delete",show:!0},{method:"copyNodeID",name:"Copy ID of this node",icon:"cuIcon-copy",show:!0},{method:"copyChildrenNodeID",name:"Copy IDs of this node's leaves",icon:"cuIcon-copy",show:!0}]}},methods:{handleBtnClick(e){this[e]()},reRoot(){var e;this.offsetRate=Number(this.offsetRate),this.offsetRate<0||1<this.offsetRate?c.showMessageBox("cuIcon-roundclose","offset value can only be 0~1","error"):(c.styleData.currentNodeIndex&&(-1!=(e=c.styleData.collapseCladeList.findIndex(e=>null==e.nodeIndex))&&c.styleData.collapseCladeList.splice(e,1),c.reRootTree(c.styleData.currentNodeIndex,this.offsetRate)),this.isShowMenu=!1)},reverseChildren(){console.log("rev c");var e=c.styleData.reverseChildrenList.findIndex(e=>e.nodeIndex==c.styleData.currentNodeIndex);-1!=e?c.styleData.reverseChildrenList.splice(e,1):c.styleData.reverseChildrenList.push({nodeIndex:c.styleData.currentNodeIndex}),c.styleData.rootNodeIndex?c.reRootTree(c.styleData.rootNodeIndex,c.styleData.rootOffsetRate):c.reRootTree()},collapseClade(){var e=c.styleData.collapseCladeList.findIndex(e=>e.nodeIndex==c.styleData.currentNodeIndex);if(-1!=e)delete c.figureData["folded clade"]["Custom color"][c.styleData.collapseCladeList[e].newNodeID],c.Vue.$refs.controlPlane.$data.controlList[0]=c.dictToControlList(c.figureData),c.styleData.collapseCladeList.splice(e,1);else{let t=prompt("Please input a node ID for this clade:");if(console.log("newCladeID",t),!t)return void c.showMessageBox("cuIcon-roundclose","ID can not be none!","error");if(-1!=c.root.leaves().findIndex(e=>e.data.name==t))return void c.showMessageBox("cuIcon-roundclose","The id is duplicated with other node ids!","error");c.styleData.collapseCladeList.push({nodeIndex:c.styleData.currentNodeIndex,newNodeID:t}),c.figureData["folded clade"]["Custom color"][t]={type:"color",value:"#cccccc",isSvgAttr:!0},c.Vue.$refs.controlPlane.$data.controlList[0]=c.dictToControlList(c.figureData)}c.styleData.rootNodeIndex?c.reRootTree(c.styleData.rootNodeIndex,c.styleData.rootOffsetRate):c.reRootTree()},deleteWholeClade(){c.styleData.deleteWholeCladeList.push({nodeIndex:c.styleData.currentNodeIndex}),c.styleData.rootNodeIndex?c.reRootTree(c.styleData.rootNodeIndex,c.styleData.rootOffsetRate):c.reRootTree()},copyNodeID(){c.treeHierarchy.descendants().forEach(e=>{e.data.nodeIndex==c.styleData.currentNodeIndex&&(c.copyText(e.data.uniformNodeId),c.showMessageBox())})},copyChildrenNodeID(e){c.treeHierarchy.descendants().forEach(e=>{e.data.nodeIndex==c.styleData.currentNodeIndex&&(c.copyText(e.leaves().map(e=>e.data.name).join("\n")),c.showMessageBox())})}}}).mount("#layout_phylotree_context_menu_app"),Vue.createApp({}).component("project-manager",{data(){return{treeTitle:"",projectList:[],currentProjectIndex:0,isPin:!0,isShow:!0}},mounted(){this.getData()},methods:{toMyTrees(){window.open("/myTrees.html")},showbox(){this.isPin||(d3.select("#project-manager-box").style("width",null).style("height",null).style("padding",".5em").style("text-align",null),this.isShow=!0)},hidebox(){this.isPin||(d3.select("#project-manager-box").style("width","30px").style("height","15px").style("padding","0").style("text-align","center"),this.isShow=!1)},save(r){if(console.log("save project........"),console.log(this.treeTitle),""==this.treeTitle)c.shakeElement(r),c.showMessageBox("cuIcon-roundclose","Title should not be blank!","error");else{let{username:a,projectId:l,titleArr:o}=this.projectList[this.currentProjectIndex],e=(t="create")=>{var e=c.exportOriginalJsonData(!0);console.log(e,a,l),null!=e?axios.post("/tvbot/saveOriginalJsonData",JSON.stringify({jsonData:JSON.stringify(e),username:a,projectId:l,treeName:this.treeTitle,treefileName:e.originalData.mainDataArr[0].fileName,leaves:c.root.leaves().length,datasetLayers:e.layer.layerList.length,layout:c.plotType,uploadType:t})).then(e=>{console.log(e),"create"==t&&o.push(this.treeTitle),c.showMessageBox()}).catch(function(e){console.log(e)}):c.shakeElement(r)};console.log(o),o.includes(this.treeTitle)?c.showYesOrNoMessageBox("Notification",`<h6 style="text-align: center;" >Title <span style="color: #0d6efd">"${this.treeTitle}"</span> already exists in this project. Do you want to replace it?</h6>`,()=>{e("update")}):e()}},async getData(){await c.getUserFigureData("/tvbot/getTVBOTToken");let{projectList:e,treeList:t}=await c.getUserFigureData("/tvbot/getTreeList");console.log("treeList",d3.group(t,e=>e.projectId)),this.projectDict=d3.group(t,e=>e.projectId),e.forEach(e=>{e.treeList=this.projectDict.has(e.projectId)?this.projectDict.get(e.projectId):[],e.titleArr=e.treeList.map(e=>e.treeName)}),this.currentProjectIndex=0,this.projectList=e;let a=new URLSearchParams(window.location.search);if(a.has("projectId")){let t=a.get("projectId");this.currentProjectIndex=e.findIndex(e=>e.projectId==t),this.treeTitle=a.get("treeTitle")}}},template:project_manager_T}).mount("#project-manager-app");var s=function(e){console.log(e),"input"!=e.target.localName&&(c.layout_phylotree_context_menu_app.$data.isShowMenu=!1)};d3.select("body").on("click",s).on("touchstart",s)}onLoadNewFile(e,t){console.log(e),console.log("source",t),this.data=e,"originalJsonData"==t?this.reRootTree(this.styleData.rootNodeIndex,this.styleData.rootOffsetRate,t):(this.styleData.rootNodeIndex=void 0,this.styleData.reverseChildrenList=[],this.reRootTree(void 0,void 0,"local"))}reRootTree_backup(t,a=.5){let l=this.newickParser(this.data).json;this.phylo=new phylotree.phylotree(this.data),console.log("phylo",this.phylo),console.log("Newick-00001",l);var o=l.children.findIndex(e=>e.name==t);if(""!=t&&-1==o&&this.showMessageBox("cuIcon-roundclose","No such leaf id!","error"),-1!=o){let e={children:[],length:a,name:""};e.children[1]=l.children.splice(o,1)[0],console.log(e),e.length=e.children[1].length*a,e.children[0]={children:l.children,length:e.children[1].length*a,name:"0.35"},e.children[1].length*=1-a,l="normalTree"==this.plotType?e:{children:[e,{length:0,name:""}],length:0,name:""}}console.log("Newick",l),this.treeHierarchy=this.phylo.nodes.sum(e=>e.length).sort((e,t)=>t.value-e.value||d3.ascending(t.data.length,e.data.length)),this.btDragData=[];let r=this.treeHierarchy.descendants().filter(e=>e.children).every(e=>{return(parseFloat(e.data.name)||(e.data.name=0))<=1});this.treeHierarchy.descendants().filter(e=>e.children).forEach(e=>{r&&(e.data.name=Math.round(100*parseFloat(e.data.name)),0==e.data.name&&(e.data.name="")),this.btDragData.push({x:0,y:0})}),console.log("treeHierarchy",this.treeHierarchy),window.treeHierarchy=this.treeHierarchy;let s=[];Object.keys(colorbrewer).forEach(e=>{s.push({name:e,colorSet:colorbrewer[e]})}),this.appData.colorList=s,this.appData.colorCount=8,this.init()}reRootTree_backup2(t,e=.5){t?(this.phylo=this.phylo.reroot(this.phylo.nodes.descendants().filter(e=>e.nodeIndex==t)[0],e),this.treeHierarchy=this.phylo.nodes):(this.phylo=new phylotree.phylotree(this.data),this.treeHierarchy=this.phylo.nodes.sum(e=>e.length)),this.treeHierarchy.descendants().forEach((e,t)=>{e.nodeIndex=`nodeIndex-${t}`}),console.log("phylo",this.phylo,t),this.btDragData=[],this.treeHierarchy.descendants().filter(e=>e.children).forEach(e=>{"string"==typeof e.data.name&&e.data.name.includes("/")&&(e.data.name=e.data.name.split("/")[0],console.log("btyy",e.data.name))});let a=this.treeHierarchy.descendants().filter(e=>e.children).every(e=>{return(parseFloat(e.data.name)||(e.data.name=0))<=1});this.treeHierarchy.descendants().filter(e=>e.children).forEach(e=>{a&&(e.data.name=100*Number(e.data.name),0==e.data.name&&(e.data.name="")),this.btDragData.push({x:0,y:0})}),this.rootLength=this.treeHierarchy.data.length,console.log("treeHierarchy",this.treeHierarchy),window.treeHierarchy=this.treeHierarchy,this.init()}reRootTree(e,a=.5,l){if(!e||"N-1"!=e){if(console.log("root_id",e,l),this.newick=this.treeParser.identifyTreeFile(this.data),console.log("myparser:#######",this.newick),e?(this.styleData.rootNodeIndex=e,this.styleData.rootOffsetRate=a,o=this.treeParser.reRoot(e,a),console.log("reRoot",o),this.treeHierarchy=d3.hierarchy(o),this.initType="rerootTree"):(this.initType="firstLoadingFile",this.treeHierarchy=d3.hierarchy(this.newick).sum(e=>e.length)),this.figureData.branches["Branches sorting"].switch.value){var o=this.figureData.branches["Branches sorting"]["sort-by"],r=o.optionList[o.value],o=this.figureData.branches["Branches sorting"]["sort-order"];let a=o.optionList[o.value];console.log("树枝排序",a),"number of leaves"==r?this.treeHierarchy.sort((e,t)=>"ascending"==a?e.leaves().length-t.leaves().length:t.leaves().length-e.leaves().length):"branch length"==r&&this.treeHierarchy.sort((e,t)=>"ascending"==a?e.data.length-t.data.length:t.data.length-e.data.length)}this.styleData.collapseCladeList&&this.styleData.collapseCladeList.forEach(t=>{this.treeHierarchy.descendants().forEach(e=>{e.data.nodeIndex==t.nodeIndex&&(delete e.children,e.data.name=t.newNodeID,e.data.uniformNodeId=t.newNodeID,e.data.isCollapse=!0,e.data.lengthMMV=d3.extent(function t(e,a,l){return a+=e.length,e.children?e.children.forEach(e=>t(e,a,l)):l.push(a),l}(e.data,-e.data.length,[])))})}),this.styleData.reverseChildrenList&&this.styleData.reverseChildrenList.forEach(t=>{this.treeHierarchy.descendants().forEach(e=>{e.data.nodeIndex==t.nodeIndex&&e.children&&(e.children=e.children.reverse())})}),this.styleData.deleteWholeCladeList&&this.styleData.deleteWholeCladeList.forEach(l=>{this.treeHierarchy.descendants().forEach(t=>{var e,a;t.data.nodeIndex==l.nodeIndex&&(a=t.parent.children.findIndex(e=>e==t),e=t.parent.data.children.findIndex(e=>e.nodeIndex==l.nodeIndex),2<t.parent.children.length||!t.parent.parent?t.parent.children.splice(a,1):2==t.parent.children.length&&(t.parent.children[a=1-a].data.length+=t.parent.data.length,t.parent.children[a].parent=t.parent.parent,t.parent.parent.children[t.parent.parent.children.findIndex(e=>e==t.parent)]=t.parent.children[a],t.parent.parent.data.children[t.parent.parent.data.children.findIndex(e=>e==t.parent.data)]=t.parent.children[a].data,console.log("node.parent",t.parent.parent.children)),t.parent.data.children.splice(e,1))})}),this.btDragData=[],this.treeHierarchy.descendants().filter(e=>e.children).forEach(e=>{"string"==typeof e.data.name&&e.data.name.includes("/")&&(e.data.name=e.data.name.split("/")[0])});var r=this.treeHierarchy.descendants().filter(e=>e.children),s=r[r.length-1].data;if("local"==l||"originalJsonData"==l){let e=[],a=[];if(this.btRangeDict={},"btArr"in s&&0<s.btArr.length?(e.push("bootstrap"),this.btRangeDict.bootstrap=d3.extent(this.treeHierarchy.descendants().filter(e=>e.children&&e.data.btArr),e=>e.data.btArr[0]),this.figureData.branches.Bootstraps.from.value=this.btRangeDict.bootstrap[0],this.figureData.branches.Bootstraps.to.value=this.btRangeDict.bootstrap[1]):e.push("None"),"otherProperty_L"in s)for(let t in s.otherProperty_L)t.includes("95%")&&a.push(t),"number"==typeof s.otherProperty_L[t]&&(e.push(t),this.btRangeDict[t]=d3.extent(this.treeHierarchy.descendants().filter(e=>e.children&&e.data.otherProperty_L),e=>e.data.otherProperty_L[t]));console.log("btarr",this.btRangeDict),this.figureData.branches.Bootstraps["data-source"].optionList=e,this.newick.isDivergenceTimeTree&&"unrootedTree"!=this.plotType?(this.figureData["node ages"]={"Confidence interval":{switch:{type:"check",value:!0,isFresh:!0},"data-source":{type:"opt",optionList:a.reverse(),value:0,isSvgAttr:!1},"dispaly-type":{type:"opt",optionList:["line","text"],value:0,isSvgAttr:!1},stroke:{type:"color",value:"#67cb9e",isSvgAttr:!0},"stroke-width":{type:"seq",value:8,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:.8,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"scale-by-factor":{type:"seq",value:1,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}},"Divergence time":{id:"Divergence-time-text",switch:{type:"check",value:!0,isFresh:!0},"scale-by-factor":{type:"seq",value:1,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"round-decimals":{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:0,max:1/0,helpLink:"https://1996xjm.github.io/tvbot/user_interface/attribute_main/branches.html#bootstraps"},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:2,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}}},"circleTree"==this.plotType&&(delete this.figureData["node ages"]["Divergence time"].id,delete this.figureData["node ages"]["Divergence time"]["text-anchor"])):"node ages"in this.figureData&&delete this.figureData["node ages"],this.Vue.$refs.controlPlane.$data.controlList[0]=this.dictToControlList(this.figureData)}"local"==l&&this.newick.isDivergenceTimeTree&&"unrootedTree"!=this.plotType&&(this.styleData.divergenceTimeTextDragData={},this.treeHierarchy.descendants().filter(e=>e.children).forEach(e=>{this.styleData.divergenceTimeTextDragData[e.data.nodeIndex]={x:0,y:0}})),"local"==l&&(console.log(s),console.log("判断有没有枝长",isNaN(s.length)),isNaN(s.length)&&(this.figureData.branches.Branches["ignore-length"].value=!0));let t=this.treeHierarchy.descendants().filter(e=>e.children).every(e=>{return(parseFloat(e.data.name)||(e.data.name=0))<=1});this.btDragData2={},this.treeHierarchy.descendants().filter(e=>e.children).forEach(e=>{t&&(e.data.name=100*Number(e.data.name),0==e.data.name&&(e.data.name="")),this.btDragData.push({x:0,y:0}),this.btDragData2[e.data.nodeIndex]={x:0,y:0}}),this.rootLength=this.treeHierarchy.data.length,console.log("treeHierarchy",this.treeHierarchy),window.treeHierarchy=this.treeHierarchy,"originalJsonData"!=l&&this.init()}}setBranchLength(e,t,a,l,o){let r=getNodeHeight(e);this.figureData.branches.Branches["ignore-length"].value?(console.log(this.innerwidth,l),e.branchLength=(t+=o-r)*this.innerwidth/l):e.branchLength=(t+=e.data.length)*a,e.children&&e.children.forEach(e=>this.setBranchLength(e,t,a,l,r))}setRadius(e,t,a,l,o){let r=getNodeHeight(e);var s=this.isInwardLayout;e.absoluteStartAngle=((this.absoluteStartAngle||0)+e.x)%360,this.figureData.branches.Branches["ignore-length"].value?(console.log(this.outerRadius,l),e.radius=(t+=o-r)*(s?this.outerRadius-this.inwardLayoutInnerRadius:this.outerRadius)/l):e.radius=(t+=e.data.length)*a,s&&(e.radius=this.outerRadius-e.radius),e.children&&e.children.forEach(e=>this.setRadius(e,t,a,l,r))}linkHorizontal(e,t="rectangular"){let a=0;this.figureData.branches.Branches["ignore-length"].value&&e.target.data.isCollapse&&(a=this.innerHeight/getNodeHeight(this.root));let l={rectangular:function(e){return`M${e.source.branchLength},${e.source.x}L${e.source.branchLength},${e.target.x}L${e.target.branchLength-a},${e.target.x}`},"rounded rectangular":function(e){let t=d3.path();return t.moveTo(e.source.branchLength,e.source.x),t.arcTo(e.source.branchLength,e.target.x,e.target.branchLength-a,e.target.x,Math.min(Math.abs(e.source.x-e.target.x),Math.abs(e.source.branchLength-(e.target.branchLength-a)))/2),t.lineTo(e.target.branchLength-a,e.target.x),t.toString()},linear:function(e){return`M${e.source.branchLength},${e.source.x}L${e.target.branchLength-a},${e.target.x}`},elliptical:function(e){const t=d3.line().x(e=>e.x).y(e=>e.y).curve(d3.curveBundle.beta(.85));e=[{x:e.source.branchLength,y:e.source.x},{x:e.source.branchLength,y:e.target.x},{x:e.target.branchLength-a,y:e.target.x}];return t(e)},bezierX:function(e){const t=d3.line().x(e=>e.x).y(e=>e.y).curve(d3.curveBumpX);e=[{x:e.source.branchLength,y:e.source.x},{x:e.target.branchLength-a,y:e.target.x}];return t(e)},bezierY:function(e){const t=d3.line().x(e=>e.x).y(e=>e.y).curve(d3.curveBumpY);e=[{x:e.source.branchLength,y:e.source.x},{x:e.target.branchLength-a,y:e.target.x}];return t(e)}};return l[t](e)}drawLeafText(t,e=0){if(this.figureData.leaves["Text style"].switch.value){const d=this;let c=d.figureData.leaves["Text style"]["word-italic"].value,h=[];try{h=c.split(",")}catch(e){}console.log(h);let e=d.layerPlaneData.layerStatistic["word italic"];e=e&&e[0],t.on("click",this.treeBranchClickFunction("leaf")).on("mouseenter",this.treeBranchEnterFunction("leaf")).on("mouseleave",this.treeBranchleaveFunction("leaf")),t.each(function(){let a=d3.select(this),o=a.data()[0],r="",s=[],i=0;var t=d.layerPlaneData.layerStatistic["modify leaves name"];d.layerPlaneData.layerStatistic["append leaves name"],d.layerPlaneData.layerStatistic["append superscript to leaves name"];if(t&&0<t.length&&t[t.length-1].isShowObj.isShow){var l=t[t.length-1],n=d.layerDataDict[l.layerDataFlieKey].dataSource;let e=d.layerDataDict[l.layerDataFlieKey].dataIndex;n=n.columns[l.layerDataColumnsIndex[0]];r=e.has(o.data.name)&&null!=e.get(o.data.name)[n]?e.get(o.data.name)[n].toString():o.data.name}else r=o.data.name;if(r.split(" ").forEach(e=>{s.push({word:e,index:i,type:"normal"}),i++}),d.layerPlaneData.layerList.forEach(t=>{if(["append leaves name","append superscript to leaves name"].includes(t.layerType)){var a=d.layerPlaneData.layerStatistic[t.layerType][t.layerStatisticIndex];if(a.isShowObj.isShow){var l=d.layerDataDict[a.layerDataFlieKey].dataSource;let e=d.layerDataDict[a.layerDataFlieKey].dataIndex;a=l.columns[a.layerDataColumnsIndex[0]];e.has(o.data.name)&&null!=e.get(o.data.name)[a]&&(r=[r,e.get(o.data.name)[a]].join(" "),"append leaves name"==t.layerType?e.get(o.data.name)[a].toString().split(" ").forEach(e=>{s.push({word:e,index:i,type:"normal"}),i++}):s.push({word:e.get(o.data.name)[a],index:i,type:"superscript"}))}}}),r=r||"",e&&e.isShowObj.isShow){l=e,n=d.layerDataDict[l.layerDataFlieKey].dataSource;let t=d.layerDataDict[l.layerDataFlieKey].dataIndex;l=n.columns[l.layerDataColumnsIndex[0]];if(t.has(o.data.name)){let e=null==t.get(o.data.name)[l]?"":t.get(o.data.name)[l];console.log("wordItalicList",e),console.log("wordItalicList",typeof e),"number"==typeof e&&(e=e.toString()),h=e.split(",")}else h=[]}s.forEach((e,t)=>{"superscript"==e.type?a.append("tspan").text(e.word).attr("baseline-shift","super").attr("font-size","0.8em"):a.append("tspan").text((0<t&&"superscript"==s[t-1].type?" ":"")+e.word+(t==s.length-1||"superscript"==s[t+1].type?"":" ")).attr("font-style",h.includes(e.index.toString())&&!["sp.","subsp."].includes(e.word)?"italic":""==c?"inherit":"normal")})}).call(e=>{this.renderAttr(e,this.figureData.leaves["Text style"]),e.attr("fill",this.figureData.leaves["Text style"].fill.value)}).call(e=>{var r=d.layerPlaneData.layerStatistic["color categories of leaves name"];if(r&&0<r.length&&r[r.length-1].isShowObj.isShow){let t=r[r.length-1];r=d.layerDataDict[t.layerDataFlieKey].dataSource;let a=d.layerDataDict[t.layerDataFlieKey].dataIndex,l=r.columns[t.layerDataColumnsIndex[0]],o=d3.scaleOrdinal().domain(t.categoryList).range(t.categoryColorList);t.controlData.color["Custom color"].switch.value&&o.range(t.categoryList.map(e=>t.controlData.color["Custom color"][e].value)),t.colorScale=o,e.filter(e=>a.has(e.data.name)&&a.get(e.data.name)[l]).attr("fill",e=>{e=a.get(e.data.name)[l];return o(e)})}})}}drawSymbol(d="normal"){let e=this.layerPlaneData.layerStatistic["add symbol"];e&&e.forEach((c,e)=>{if(c.isShowObj.isShow){let t=this.layerDataDict[c.layerDataFlieKey].dataSource,s=this.layerDataDict[c.layerDataFlieKey].dataIndex;var h=c.controlData.symbol["Symbol position"]["canvas-width"].value;let e=c.layerDataColumnsIndex.map(e=>t.columns[e]),a=d3.scaleBand().domain(e).range([0,h]).padding(c.controlData.symbol["Symbol position"].padding.value),l=d3.scaleOrdinal().domain(c.categoryList).range(c.categoryColorList);c.controlData.symbol["Symbol color"].switch.value&&l.range(c.categoryList.map(e=>c.controlData.symbol["Symbol color"][e].value)),c.colorScale=l;let o=parseFloat(c.controlData.symbol["Symbol position"].offset.value),r=parseFloat(c.controlData.symbol["Symbol style"].size.value),i=c.controlData.symbol["Symbol position"].align.value;console.log(i);let n="circle"==d?this.polarGroup:this.maingroup;if(i&&c.controlData.background.Background.switch.value)if("circle"==d){let e=d3.arc().innerRadius(o+this.outerRadius).outerRadius(o+this.outerRadius+h).startAngle((this.treeStartAngle+90)*Math.PI/180).endAngle(this.treeEndAngle*Math.PI/180);n.append("path").attr("d",e()).attr("class",c.controlData.background.Background.id).call(e=>{this.renderAttr(e,c.controlData.background.Background)})}else n.append("rect").lower().attr("class",c.controlData.background.Background.id).attr("x",this.maxLength+o).attr("width",h).attr("height",this.innerHeight).call(e=>{this.renderAttr(e,c.controlData.background.Background)});n.append("g").selectAll("newSymbol").data(this.root.leaves().filter(e=>s.has(e.data.name))).join("g").attr("transform",e=>"circle"==d?`rotate(${e.x+this.treeStartAngle}) translate(${(i?this.outerRadius:e.radius)+o},0)`:`translate(${(i?this.maxLength:e.branchLength)+o},${e.x})`).selectAll("symbolPath").data(o=>{console.log("kjhk",o);let r=[];return e.forEach(e=>{var t,a,l=s.get(o.data.name)[e];null!=l&&(t=c.controlData.symbol["Symbol type"][l].value,t=(a=c.controlData.symbol["Symbol type"][l].optionList[t].split("-"))[0],a=a[1],r.push({category:l,symbol_type:t,isFill:a,columnsName:e}))}),r}).join("g").attr("transform",e=>`translate(${a(e.columnsName)+a.bandwidth()/2},0)`).append("path").attr("d",e=>d3.symbol().type(d3[e.symbol_type]).size(r)()).attr("fill",e=>{var t=l(e.category);return"fill"==e.isFill?t:"none"}).attr("stroke",e=>{var t=l(e.category);return"fill"==e.isFill?c.controlData.symbol["Symbol style"].stroke.value:t}).attr("stroke-width",e=>{var t=c.controlData.symbol["Symbol style"]["stroke-width"].value;return"fill"==e.isFill||1<t?t:1})}})}drawPieChart(c="normal"){let e=this.layerPlaneData.layerStatistic["pie chart"];e&&e.forEach((i,e)=>{if(i.isShowObj.isShow){var n=this.layerDataDict[i.layerDataFlieKey].dataSource;let a=this.layerDataDict[i.layerDataFlieKey].dataIndex;n.columns[i.layerDataColumnsIndex[0]];let t=d3.scaleOrdinal().domain(i.categoryList).range(i.categoryColorList);i.controlData.pie["Custom color"].switch.value&&t.range(i.categoryList.map(e=>i.controlData.pie["Custom color"][e].value)),i.colorScale=t;let l=i.controlData.pie["Pie style"]["x-offset"].value;n=i.controlData.pie["Pie style"]["position-type"];let o=n.optionList[n.value],e="circle"==c?this.polarGroup:this.maingroup,r=this.root.leaves().filter(e=>a.has(e.data.name)),s={};r.forEach(t=>{var e=i.categoryList.map(e=>({value:a.get(t.data.name)[e],category:e}));s[t.data.name]=d3.pie().sort(null).value(e=>e.value)(e)});n=d3.arc().innerRadius(i.controlData.pie["Pie style"].innerRadius.value).outerRadius(e=>"circle"==c?this.outerRadius*Math.PI*(this.treeEndAngle-this.absoluteStartAngle)/360/this.root.leaves().length+i.controlData.pie["Pie style"]["radius-offset"].value:this.innerHeight/this.root.leaves().length/2+i.controlData.pie["Pie style"]["radius-offset"].value);e.append("g").selectAll("newSymbol").data(r).join("g").attr("transform",e=>{let t=l;return"circle"==c?("uniform"==o&&(t+=this.outerRadius),"at the end of branch"==o&&(t+=e.radius),"in the middle of branch"==o&&(t+=e.radius-this.treeScale*e.data.length/2),`rotate(${e.x+this.treeStartAngle}) translate(${t},0)`):("uniform"==o&&(t+=this.maxLength),"at the end of branch"==o&&(t+=e.branchLength),"in the middle of branch"==o&&(t+=e.branchLength-this.treeScale*e.data.length/2),`translate(${t},${e.x})`)}).selectAll("path").data(e=>s[e.data.name]).join("path").attr("d",n).attr("fill",e=>t(e.data.category)).attr("class",i.controlData.pie["Pie style"].id).call(e=>{this.renderAttr(e,i.controlData.pie["Pie style"])})}})}drawBranchPieChart(h="normal"){const d=this;let e=d.layerPlaneData.layerStatistic["branch pie chart"];e&&e.forEach((n,e)=>{if(n.isShowObj.isShow){var c=this.layerDataDict[n.layerDataFlieKey].dataSource;let a=this.layerDataDict[n.layerDataFlieKey].dataIndex;c.columns[n.layerDataColumnsIndex[0]];let t=d3.scaleOrdinal().domain(n.categoryList).range(n.categoryColorList);n.controlData.pie["Custom color"].switch.value&&t.range(n.categoryList.map(e=>n.controlData.pie["Custom color"][e].value)),n.colorScale=t;let l=n.controlData.pie["Pie style"]["x-offset"].value,o=n.controlData.pie["Pie style"]["y-offset"].value;c=n.controlData.pie["Pie style"]["position-type"];let r=c.optionList[c.value],e="circle"==h?this.polarGroup:this.maingroup,s=this.root.descendants().filter(e=>a.has(e.data.uniformNodeId)),i={};s.forEach(t=>{var e=n.categoryList.map(e=>({value:a.get(t.data.uniformNodeId)[e],category:e}));i[t.data.uniformNodeId]=d3.pie().sort(null).value(e=>e.value)(e)});c=d3.arc().innerRadius(n.controlData.pie["Pie style"].innerRadius.value).outerRadius(e=>n.controlData.pie["Pie style"].outerRadius.value);e.append("g").selectAll("newSymbol").data(s).join("g").attr("transform",a=>{if("unrooted"==h){let e=a.absolutePosition.x,t=a.absolutePosition.y;return"start"==r&&a.parent&&(e=a.parent.absolutePosition.x,t=a.parent.absolutePosition.y),"middle"==r&&a.parent&&(e=(a.absolutePosition.x+a.parent.absolutePosition.x)/2,t=(a.absolutePosition.y+a.parent.absolutePosition.y)/2),`translate(${e},${t})rotate(${a.absoluteAngle-90})`}{var t="circle"==h?"radius":"branchLength";let e=a[t];return a.parent?("middle"==r&&(e=(a[t]+a.parent[t])/2),"start"==r&&(e=a.parent[t])):("middle"==r&&(e=this.isInwardLayout?this.outerRadius-a[t]/2:a[t]/2),"start"==r&&(e=this.isInwardLayout?this.outerRadius:0)),"circle"==h?`rotate(${a.x+this.treeStartAngle})translate(${e},0)${a.absoluteStartAngle<180?"":" rotate(180)"}`:`translate(${e},${a.x})`}}).selectAll("BTG").data(e=>{let t=n.otherData.pieDragData[e.data.nodeIndex];return t.uniformNodeId=e.data.uniformNodeId,[t]}).join("g").attr("transform",e=>`translate(${e.x},${e.y})`).call(d.drag()).append("g").attr("transform",e=>`translate(${l},${o})`).selectAll("path").data(e=>i[e.uniformNodeId]).join("path").attr("d",c).attr("fill",e=>t(e.data.category)).attr("class",n.controlData.pie["Pie style"].id).call(e=>{this.renderAttr(e,n.controlData.pie["Pie style"])})}})}drawNodeAges(s="normal"){if(this.newick.isDivergenceTimeTree&&!this.isInwardLayout){let e="normal"==s?this.maingroup:this.polarGroup;var a=this.root.descendants().filter(e=>e.data.otherProperty_L);let r=this.figureData["node ages"]["Confidence interval"],o=this.figureData["node ages"]["Divergence time"],t=e.selectAll("branchTextLabelG").data(a).join("g").attr("transform",e=>{return"unrooted"!=s?"circle"==s?`rotate(${e.x+this.treeStartAngle})translate(${e.radius},0)${e.absoluteStartAngle<180?"":" rotate(180)"}`:`translate(${e.branchLength},${e.x})`:`translate(${e.absolutePosition.x},${e.absolutePosition.y})rotate(${e.absoluteAngle-90})`});if(r.switch.value){var l=r["dispaly-type"],a=l.optionList[l.value],l=r["data-source"];let o=l.optionList[l.value];console.log("pro_key",o),"line"==a?t.filter(e=>o in e.data.otherProperty_L).append("line").attr("x1",e=>{console.log("d.data.otherProperty_L",e,e.data.otherProperty_L);var[t,a]=e.data.otherProperty_L[o];return"circle"==s?this.outerRadius-(e.absoluteStartAngle<180?a:t)*this.treeScale-e.radius:this.innerwidth-a*this.treeScale-e.branchLength}).attr("x2",e=>{var[t,a]=e.data.otherProperty_L[o];return"circle"==s?this.outerRadius-(e.absoluteStartAngle<180?t:a)*this.treeScale-e.radius:this.innerwidth-t*this.treeScale-e.branchLength}).attr("stroke",r.stroke.value).attr("stroke-width",r["stroke-width"].value).attr("stroke-opacity",r["stroke-opacity"].value):"text"==a&&t.append("text").text(e=>{var t=r["scale-by-factor"].value;let[a,l]=e.data.otherProperty_L[o];return a*=t,l*=t,`[${Number(a.toFixed(10))}, ${Number(l.toFixed(10))}]`}).attr("fill",r.fill.value).attr("font-size",r["font-size"].value).attr("font-weight",r["font-weight"].value).attr("x",r.x.value).attr("y",r.y.value).attr("text-anchor","middle")}o.switch.value&&this.styleData.divergenceTimeTextDragData&&t.selectAll("BTG").data(e=>{let t=e.data.nodeIndex in this.styleData.divergenceTimeTextDragData?this.styleData.divergenceTimeTextDragData[e.data.nodeIndex]:{x:0,y:0};return t.node={radius:e.radius,branchLength:e.branchLength,x:e.x},[t]}).join("g").attr("transform",e=>`translate(${e.x},${e.y})`).call(this.drag()).append("text").attr("class","circle"==s?null:o.id).text(e=>{var t=e.node,a=o["scale-by-factor"].value,e=o["round-decimals"].value;let l=("circle"==s?this.outerRadius-t.radius:this.innerwidth-t.branchLength)/this.treeScale*a;return l=Number(l.toFixed(10)),e<1?l:d3.format(`.${e}f`)(l)}).call(e=>{this.renderAttr(e,o),"circle"==s&&(e.attr("x",e=>(e.node.absoluteStartAngle<180?1:-1)*o.x.value),e.attr("text-anchor",e=>e.node.absoluteStartAngle<180?"end":"start"))})}}drawBranchTextLabel(n="normal"){const c=this;let e=c.layerPlaneData.layerStatistic["branch text label"]||[];e.forEach((r,e)=>{if(r.isShowObj.isShow){let e="normal"==n?this.maingroup:this.polarGroup,a=this.layerDataDict[r.layerDataFlieKey].dataIndex,t=this.layerDataDict[r.layerDataFlieKey].dataSource;var s=this.root.descendants().filter(e=>a.has(e.data.uniformNodeId));let l=r.layerDataColumnsIndex.map(e=>t.columns[e])[0];var i=r.controlData.text["Text style"]["position-type"];let o=i.optionList[i.value];e.selectAll("branchTextLabelG").data(s).join("g").attr("transform",a=>{if("unrooted"==n){let e=a.absolutePosition.x,t=a.absolutePosition.y;return"start"==o&&a.parent&&(e=a.parent.absolutePosition.x,t=a.parent.absolutePosition.y),"middle"==o&&a.parent&&(e=(a.absolutePosition.x+a.parent.absolutePosition.x)/2,t=(a.absolutePosition.y+a.parent.absolutePosition.y)/2),`translate(${e},${t})rotate(${a.absoluteAngle-90})`}{var t="circle"==n?"radius":"branchLength";let e=a[t];return a.parent?("middle"==o&&(e=(a[t]+a.parent[t])/2),"start"==o&&(e=a.parent[t])):("middle"==o&&(e=this.isInwardLayout?this.outerRadius-a[t]/2:a[t]/2),"start"==o&&(e=this.isInwardLayout?this.outerRadius:0)),"circle"==n?`rotate(${a.x+this.treeStartAngle})translate(${e},0)${a.absoluteStartAngle<180?"":" rotate(180)"}`:`translate(${e},${a.x})`}}).selectAll("BTG").data(e=>{let t=r.otherData.textDragData[e.data.nodeIndex];return t.text=a.get(e.data.uniformNodeId)[l],[t]}).join("g").attr("transform",e=>`translate(${e.x},${e.y})`).call(c.drag()).append("text").attr("class",r.controlData.text["Text style"].id).text(e=>e.text).call(e=>{this.renderAttr(e,r.controlData.text["Text style"]),0<r.controlData.text["Text style"]["stroke-width"].value&&(e.clone().text(e=>e.text),e.attr("stroke",r.controlData.text["Text style"].stroke.value),e.attr("stroke-width",r.controlData.text["Text style"]["stroke-width"].value))})}})}colorBranch(){let e=this.layerPlaneData.layerStatistic["color categories of branches"];e&&e.forEach((t,e)=>{if(t.isShowObj.isShow){let e=d3.scaleOrdinal().domain(t.categoryList).range(t.categoryColorList);t.controlData.color["Custom color"].switch.value&&e.range(t.categoryList.map(e=>t.controlData.color["Custom color"][e].value)),t.colorScale=e;var i=this.layerDataDict[t.layerDataFlieKey].dataSource;let a=this.layerDataDict[t.layerDataFlieKey].dataIndex,l=i.columns[t.layerDataColumnsIndex[0]],o="",r=[],s=[];this.root.leaves().filter(e=>a.has(e.data.name)).forEach(t=>{if(a.get(t.data.name)[l]!=o){let e=[t];e.category=a.get(t.data.name)[l],r.push(e),o=a.get(t.data.name)[l]}else r[r.length-1].push(t)}),console.log("leaves_category_arr",r),r.filter(e=>null!=e.category).forEach(l=>{let t=1/0,a=null;l.forEach(e=>{e.depth<t&&(a=e,t=e.depth)}),console.log(a.parent);let o=function e(t){var a={value:0};return function t(e,a){return e.children?void e.children.forEach(e=>{l.includes(e)&&a.value++,t(e,a)}):a}(t,a),a.value==l.length?t:e(t.parent)}(a.parent);console.log("commonAncestor",o),console.log("category",l.category);let e=[];e.category=l.category,s.push(e),l.forEach(e=>{let a=s.length-1;s[a].push(e),function e(t){t!=o&&(-1==s[a].findIndex(e=>e==t.parent)&&s[a].push(t.parent),e(t.parent))}(e)})}),console.log("leaves_category_arr",r),console.log("branch_category_node_arr",s),s.forEach(t=>{d3.selectAll(".branches-path").filter(e=>e&&t.includes(e.source)&&t.includes(e.target)).attr("stroke",e(t.category))})}})}drawLegend(){"firstLoadingFile"==this.initType&&(e=40/this.treeScale,e=Number(d3.format(".1r")(e)),this.figureData["scale legend"]["Tree scale"].scale.value=e,this.initType=void 0);let t=this.figureData["scale legend"]["Tree scale"].scale.value;this.figureData.branches.Branches["ignore-length"].value||this.maingroup.append("g").data([this.styleData.legendTreeScaleDragData]).attr("transform",e=>`translate(${e.x},${e.y})`).call(this.drag()).call(e=>{e.append("text").text(t).attr("y",-5-this.figureData["scale legend"]["Scale line"]["stroke-width"].value/2).attr("x",t*this.treeScale/2).attr("text-anchor","middle").call(e=>{this.renderAttr(e,this.figureData["scale legend"]["Scale text"])}),e.append("text").text("Tree scale").attr("text-anchor","end").attr("x",-10).call(e=>{this.renderAttr(e,this.figureData["scale legend"]["Scale text"])}),e.append("line").attr("x2",t*this.treeScale).call(e=>{this.renderAttr(e,this.figureData["scale legend"]["Scale line"])})});var e=this.figureData.branches.Bootstraps.type;let a=e.optionList[e.value];e=this.figureData.branches.Bootstraps["data-source"],e=e.optionList[e.value];if(this.figureData.branches.Bootstraps.switch.value&&"None"!=e||(a="None"),"circle"==a){let t={},e=[">90%","70-90%"];e.forEach(e=>{t[e]="symbolCircle-fill"}),console.log(t),this.legendObj.drawCategoryShapeLegend(this.figureData["BT legend"],e,d3.scaleOrdinal().domain(e).range(["#000000","#aaaaaa"]),t,this.styleData.legendBTDragData)}if("gradient color circle"==a){let e=void 0;this.figureData["BT color bar legend"]["ColorBar range"]["median-value"].value&&(e=Number(this.figureData["BT color bar legend"]["ColorBar range"]["median-value"].value)),this.legendObj.drawColorBarLegend(this.figureData["BT color bar legend"],this.mmvBTvalue,d3[this.styleData.currentColorInterpolate],this.styleData.BTcolorBarDragData,e)}let l=this.layerPlaneData.layerStatistic["color block of leaves name"];l&&l.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawBaseCategoryLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let o=this.layerPlaneData.layerStatistic["color categories of leaves name"];o&&o.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawBaseCategoryLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let r=this.layerPlaneData.layerStatistic["color categories of branches"];r&&r.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawCategoryBranchesLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let s=this.layerPlaneData.layerStatistic["pie chart"];s&&s.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawCategoryArcLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let i=this.layerPlaneData.layerStatistic["branch pie chart"];i&&i.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawCategoryArcLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let n=this.layerPlaneData.layerStatistic["bar plot with category"];n&&n.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawBaseCategoryLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let c=this.layerPlaneData.layerStatistic["lollipop plot with category"];c&&c.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawBaseCategoryLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData,{shape:"circle"})});let h=this.layerPlaneData.layerStatistic["box plot with category"];h&&h.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawCategoryBoxLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let d=this.layerPlaneData.layerStatistic["stacked bar plot"];d&&d.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawBaseCategoryLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let u=this.layerPlaneData.layerStatistic["text map with category"];u&&u.forEach(e=>{e.isShowObj.isShow&&this.legendObj.drawBaseCategoryLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let p=this.layerPlaneData.layerStatistic["link between two nodes"];p&&p.forEach(e=>{e.isShowObj.isShow&&e.controlData.link["Color categories"]&&e.controlData.link["Color categories"].switch.value&&this.legendObj.drawCategoryLineLegend(e.controlData.legend,e.colorScale.domain(),e.colorScale,e.legendDragData)});let g=this.layerPlaneData.layerStatistic["add symbol"];g&&g.forEach(o=>{if(console.log(o),o.isShowObj.isShow){let l={};o.categoryList.map(e=>{var t=o.controlData.symbol["Symbol type"],a=t[e].value;l[e]=t[e].optionList[a]}),this.legendObj.drawCategoryShapeLegend(o.controlData.legend,o.colorScale.domain(),o.colorScale,l,o.legendDragData)}});let y=this.layerPlaneData.layerStatistic.heatmap;y&&y.forEach(t=>{if(console.log(t),t.isShowObj.isShow){let e=void 0;t.controlData.legend["ColorBar range"]["median-value"].value&&(e=Number(t.controlData.legend["ColorBar range"]["median-value"].value)),this.legendObj.drawColorBarLegend(t.controlData.legend,t.mmv,t.customColorInterpolate,t.legendDragData,e)}});let v=this.layerPlaneData.layerStatistic["binary type 2"];v&&v.forEach(o=>{if(console.log(o),o.isShowObj.isShow){let l=o.controlData.legend;l.Legend.switch.value&&this.zoomG.append("g").data([o.legendDragData]).attr("transform",e=>`translate(${e.x},${e.y})`).attr("text-anchor","start").call(this.drag()).call(e=>{e=e.append("text").attr("class",l["Legend title"].id);this.renderAttr(e,l["Legend title"]),this.renderText(e,l["Legend title"].text.value)}).selectAll("rectG").data([{name:l["Text content"][1].value,value:1},{name:l["Text content"][0].value,value:0}]).join("g").attr("transform",(e,t)=>`translate(0,${t*l.Square.spacing.value})`).call(e=>{var t=l.Square,a=e.append("rect").attr("class",t.id).attr("x",-t.size.value).attr("width",t.size.value).attr("height",t.size.value).attr("fill-opacity",e=>o.controlData.cell["Custom color"].switch.value?(o.controlData.cell["Cell style"].fill.isSvgAttr=!1,1):0==e.value?.4:1).attr("fill",e=>(o.controlData.cell["Custom color"].switch.value?0==e.value?o.controlData.cell["Custom color"].absent:o.controlData.cell["Custom color"].present:o.controlData.cell["Cell style"].fill).value);this.renderAttr(a,t);a=l["Text style"],t=e.append("text").attr("class",a.id).attr("dy","0.3em").attr("y",t.size.value/2).text(e=>e.name);this.renderAttr(t,a)})}});let m=this.layerPlaneData.layerStatistic["bubble plot"];m&&m.forEach(e=>{var t;console.log(e),e.isShowObj.isShow&&(t=e.controlData.legend,this.legendObj.drawBaseSizeLegend(t,e.mmv,e.rScale,e.legendDragData,{symbolType:e.symbolType}))})}}function maxLength(e,t=!1){return null!=e.length&&!isNaN(e.length)||(e.length=1),e.length+(e.children?d3.max(e.children,e=>maxLength(e,t)):0)}function getNodeHeight(e){return 1+(e.children?d3.max(e.children,e=>getNodeHeight(e)):0)}export{MainTree,maxLength,getNodeHeight};