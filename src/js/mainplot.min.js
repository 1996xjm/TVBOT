const eagleMapContainer_T=`<div id="eagleMapContainer"  :style="{width: width.value + 'px', height: height.value + 'px'}" :class="{mouseon:isScaleMouseOn}">
        <div id="scale-right" @touchstart="dragEagle($event,0),showScaleBox(0)"   @mousedown="dragEagle($event,0)" @mouseover="showScaleBox(0)" @mouseleave="hideScaleBox(0)" :class="{flow_y:isScaleMouseOn}"></div>
        <div id="scale-bottom" @touchstart="dragEagle($event,1),showScaleBox(0)"  @mousedown="dragEagle($event,1)" @mouseover="showScaleBox(0)" @mouseleave="hideScaleBox(0)" :class="{flow_x:isScaleMouseOn}"></div>
        <div id="scale-se" @touchstart="dragEagle($event,3),showScaleBox(0)"   @mousedown="dragEagle($event,3)" @mouseover="showScaleBox(0)" @mouseleave="hideScaleBox(0)"></div>
        <div id="margin-box" v-show="showMarginBox.value"   :style="{top: marginTop.value + 'px', left: marginLeft.value  + 'px', width: width.value-marginLeft.value-marginRight.value + 'px',height: height.value-marginTop.value-marginBottom.value + 'px'}">
            <div id="margin-right" :class="{flow_y:isMarginMouseOn}" @touchstart="marginEagle($event,0)" @mousedown="marginEagle($event,0)" @mouseover="showScaleBox(1)" @mouseleave="hideScaleBox(1)"></div>
            <div id="margin-left" :class="{flow_y:isMarginMouseOn}" @touchstart="marginEagle($event,1)" @mousedown="marginEagle($event,1)" @mouseover="showScaleBox(1)" @mouseleave="hideScaleBox(1)"></div>
            <div id="margin-top" :class="{flow_x:isMarginMouseOn}" @touchstart="marginEagle($event,2)" @mousedown="marginEagle($event,2)" @mouseover="showScaleBox(1)" @mouseleave="hideScaleBox(1)"></div>
            <div id="margin-bottom" :class="{flow_x:isMarginMouseOn}" @touchstart="marginEagle($event,3)" @mousedown="marginEagle($event,3)" @mouseover="showScaleBox(1)" @mouseleave="hideScaleBox(1)"></div>
        </div>

    </div>`,controlPlane_T=`

<div id="color-bar-select" style="width:300px;position: fixed;right: -300px;">
<div style="display: flex;">
        <div id="color-select_close_btn" @click="hideColorBarSelecter">
            >
        </div>
        <div style="flex: 1;height: 600px;overflow: scroll;">
                <div class="color_set_row"  style="height: 30px;" v-for="(it,ci) in colorBarList">
<svg height="20" width="200">
<image width="200" height="20" preserveAspectRatio="none" :xlink:href="it.dataImage"></image>
</svg>
            <input type="checkbox" width="40px"  @click="changeColorBar(it.name, $event)">
        </div>

</div>

</div>


    </div>




<div id="color-select" :style="{right: -colorCount*38 + 'px', width: colorCount*38 + 'px'}">
<div style="display: flex;">
        <div id="color-select_close_btn" @click="hideColorSelecter">
            >
        </div>
        <div style="flex: 1;height: 600px;overflow: scroll;">
                <div class="color_set_row"  style="height: 30px;" v-for="(it,ci)  in colorList">
            <div style="width: 30px; margin-left: 3px;" :style="{backgroundColor: c}"  v-for="c in it.colorSet"></div>
            <input type="checkbox" style="margin-left: 5px;" width="40px"  @click="changeColorSet(ci,$event)">
        </div>

</div>

</div>


    </div>
    <div id="control-container"  style="display: flex;flex-direction: column;min-width:350px;max-width: 450px;position: fixed;right: 0px;border-radius: 4px;overflow: hidden;z-index: 190;">
        <div id="attr-container-header"  class="xiaochi-background" style="display: flex;justify-content: space-between;align-items: center;">
        <div id="hide-control-container-btn" :class="{'cuIcon-unfold': isControlContainerShow,'cuIcon-fold':!isControlContainerShow}"  @click="hideControlContainer"></div>
        <div style="height: 100%;display: flex;align-items: center;">
        
        <label v-show="isControlContainerShow" style="margin-right: 5px;color: white;">中文</label>
               <input v-show="isControlContainerShow"  type="checkbox"  class="a-switch"  style="display: inline-block;margin-right: 5px;"  @change="changeLanguage">
 
</div>

        </div>
<div  class="mynav-horizontal" >
  <div :class="hTabIndex==navi?'cu-item text-orange cur':'cu-item'" @click="hTabSelect(navi)" v-for="(navh,navi) in navHList">{{navh}}</div>

</div>
        <div id="VerticalBox">

            <div class="tab_out_box mynav"  >
            <template v-for="(it,index) in controlList[cindex]">
            

                <div :class="currentIndex==index?'cu-item text-orange cur':'cu-item'" v-show="it.isDisplay != false"   @click="tabSelect(index)">
                    {{en2cnData[it.tabName] == undefined ? it.tabName : en2cnData[it.tabName]}}
                </div>
                </template>
            </div>
            <div class="attr_plane_box" >
                <section class="attr_section" v-for="cl in controlList[cindex]" v-show="cl.isShow">
                    <div class="attr_type_out_box" v-for="at in cl.attrTypeList">
                        <div class="attr_type_name xiaochi-background" >{{en2cnData[at.type] == undefined ? at.type : en2cnData[at.type]}}</div>
                        <div class="attr_list_box">
                        <table>
                        <tbody >
                        <template v-for="a in at.attrList" >
                                                    <tr  v-if="a.attrName!='id'" class="attr_item_box"  >
                                                    
                                <td :class="{textInputLabel:a.value.type=='text',numInputLabel:a.value.type=='seq'}"  @touchmove.prevent @mousedown="dragScaleValue($event,at.attrList[0].value,a.value,cl.tabName,at.type,a.attrName)" @touchstart="dragScaleValue($event,at.attrList[0].value,a.value,cl.tabName,at.type)"  class="my-form-label" >{{en2cnData[a.attrName]== undefined ? a.attrName : en2cnData[a.attrName]}}</td>
                                <td>


                                <input  class="form-control " style="display: inline-block;" :class="{textInput:a.value.type=='text',numInput:a.value.type=='seq'}" :type="a.nodeType" :id="cl.tabName+at.type+a.attrName" v-if="a.nodeType=='text'" v-model="a.value.value" @change="set(cl.tabName,at.type,a.attrName,a.value.value,a)">
                                <input :type="a.nodeType" v-if="a.nodeType=='checkbox'" class="a-switch"  style="display: inline-block;" v-model="a.value.value" @change="set(cl.tabName,at.type,a.attrName,a.value.value,a)">
                                <input :type="a.nodeType" v-if="a.nodeType=='color'" v-model="a.value.value" @change="set(cl.tabName,at.type,a.attrName,a.value.value,a)">
                                <button type="button"   class="mybutton" :class="{loading: a.value.isLoading,[a.value.iconClass]:1,bgGray:a.value.isBGGray}"     v-if="a.nodeType=='button'" @click="handleClick(a, $event)">{{a.value.value}}</button>
                                <button  class="mybutton" :class="a.value.iconClass" v-if="a.nodeType=='file'"    @click="addFile"></button>
                                <select :id="cl.tabName+at.type+a.attrName" style="width: 80px;"   v-model="a.value.value" v-if="a.nodeType=='select'" @change="set(cl.tabName,at.type,a.attrName,a.value.value,a)">
                                    <option :value="index" v-for="(op,index) in a.optionList">{{op}}</option>
                                </select>
                                <a v-if="a.value.helpLink" :href="a.value.helpLink" target="_blank" style="display:inline-block;margin-left: 5px;width: 20px;height: 20px;background-color: var(--bs-orange);border-radius: 100%;line-height: 20px;text-align: center;color: white;text-decoration: none;">?</a>
                                </td>
                                
                            </tr>
</template>
                        </tbody>
                        </table>

                        </div>
                    </div>

                </section>

            </div>
        </div>
    </div>`;var colorList=[{name:"Accent",colorSet:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},{name:"Dark2",colorSet:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},{name:"Paired",colorSet:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},{name:"Pastel1",colorSet:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},{name:"Pastel2",colorSet:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},{name:"Set1",colorSet:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},{name:"Set2",colorSet:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},{name:"Set3",colorSet:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]},{name:"Set4",colorSet:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"]},{name:"Set5",colorSet:["#3f1351","#3e678a","#5fb37e","#fae755"]},{name:"Set6",colorSet:["#e87c70","#5e7baf","#666666","#5fb37e"]},{name:"Set7",colorSet:["#f8766e","#01bec4"]},{name:"Set8",colorSet:["#44757a","#452a3d","#d44c3c","#eed5b7","#e5855d"]},{name:"Set9",colorSet:["#669bbb","#002f49","#780001","#fef0d5"]},{name:"Set10",colorSet:["#a40545","#f46f44","#fdd985","#e9f5a1","#7fcba4","#4b65af"]},{name:"Set11",colorSet:["#e54b3c","#495d90","#07987f","#8a6b53"]},{name:"Set12",colorSet:["#6595ca","#fcc216","#39c271","#ff6668"]},{name:"Set13",colorSet:["#b7b7ff","#a6ffa4","#ebc0a5"]},{name:"YlGn",colorSet:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},{name:"YlGnBu",colorSet:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},{name:"GnBu",colorSet:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},{name:"BuGn",colorSet:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},{name:"PuBuGn",colorSet:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},{name:"PuBu",colorSet:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},{name:"BuPu",colorSet:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},{name:"RdPu",colorSet:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},{name:"PuRd",colorSet:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},{name:"OrRd",colorSet:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},{name:"YlOrRd",colorSet:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},{name:"YlOrBr",colorSet:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},{name:"Purples",colorSet:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},{name:"Blues",colorSet:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},{name:"Greens",colorSet:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},{name:"Oranges",colorSet:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},{name:"Reds",colorSet:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},{name:"Greys",colorSet:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},{name:"PuOr",colorSet:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},{name:"BrBG",colorSet:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},{name:"PRGn",colorSet:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},{name:"PiYG",colorSet:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},{name:"RdBu",colorSet:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},{name:"RdGy",colorSet:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},{name:"RdYlBu",colorSet:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},{name:"Spectral",colorSet:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},{name:"RdYlGn",colorSet:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]}];import{FileManager}from"/static/xiaochiPlot/js/filemanager.js";import{FooterQRCode}from"/static/js/footerQRCode.js";import{LayerComponent}from"/static/xiaochiPlot/js/layer.js";import{Legend}from"/static/xiaochiPlot/js/legend.js";class Symbol{constructor(){this.symbolTypeArr=["circle","square","star","cross","rightTriangle","leftTriangle","upTriangle","downTriangle"]}getPath(e="circle",t=10){return this.r=t,this[e]()}circle(){let e=d3.path();return e.arc(0,0,this.r,0,2*Math.PI),e.toString()}square(){let e=d3.path();var t=this.r;return e.moveTo(-t,-t),e.lineTo(t,-t),e.lineTo(t,t),e.lineTo(-t,t),e.closePath(),e.toString()}star(){let e=d3.path();for(var t=this.r,a=t/2,o=0;o<5;o++)0==o?e.moveTo(Math.cos((18+72*o)/180*Math.PI)*t,-Math.sin((18+72*o)/180*Math.PI)*t):e.lineTo(Math.cos((18+72*o)/180*Math.PI)*t,-Math.sin((18+72*o)/180*Math.PI)*t),e.lineTo(Math.cos((54+72*o)/180*Math.PI)*a,-Math.sin((54+72*o)/180*Math.PI)*a);return e.closePath(),e.toString()}cross(){let e=d3.path();var t=this.r,a=this.r/3;return e.moveTo(-a,-t),e.lineTo(a,-t),e.lineTo(a,-a),e.lineTo(t,-a),e.lineTo(t,a),e.lineTo(a,a),e.lineTo(a,t),e.lineTo(-a,t),e.lineTo(-a,a),e.lineTo(-t,a),e.lineTo(-t,-a),e.lineTo(-a,-a),e.closePath(),e.toString()}rightTriangle(){let e=d3.path();var t=this.r;return e.moveTo(-t,-t),e.lineTo(t,0),e.lineTo(-t,t),e.closePath(),e.toString()}leftTriangle(){let e=d3.path();var t=this.r;return e.moveTo(t,-t),e.lineTo(t,t),e.lineTo(-t,0),e.closePath(),e.toString()}upTriangle(){let e=d3.path();var t=this.r;return e.moveTo(0,-t),e.lineTo(t,t),e.lineTo(-t,t),e.closePath(),e.toString()}downTriangle(){let e=d3.path();var t=this.r;return e.moveTo(0,t),e.lineTo(t,-t),e.lineTo(-t,-t),e.closePath(),e.toString()}}class MainPlot{constructor(e){this.symbolGenerator=new Symbol,d3.symbolDownTriangle={draw(e,t){var a=Math.sqrt(3),t=-Math.sqrt(t/(3*a));e.moveTo(0,2*-t),e.lineTo(-a*t,t),e.lineTo(a*t,t),e.closePath()}},this.createDom(),this.originalData={mainDataArr:[],metaDataArr:[]},this.styleData={isUseColorGradient:!1,currentColorInterpolate:"interpolateRainbow",currentColorList:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},this.en2cnData={treefile:"树文件","Canvas scale":"画布大小",Margin:"边距",Zooming:"缩放","Text style":"文本样式","Leaves Extension":"叶节点对齐",Branches:"树枝",Bootstraps:"自展值","Tree scale":"枝长比例","Reroot tree":"重置根节点","Global font style":"全局字体样式","Save figure":"保存图片",data:"数据",canvas:"画布",leaves:"叶",branches:"枝",legend:"图例",root:"根",export:"导出","select-file":"选择文件",width:"宽",height:"高",left:"左边",right:"右边",top:"顶边",bottom:"底边",showMarginBox:"显示边距方框",reset:"重置","font-size":"字体大小","text-anchor":"文本锚点",fill:"填充","font-weight":"字体粗细","font-style":"字体样式","word-italic":"单词斜体",extension:"对齐",stroke:"描边","stroke-width":"描边宽度","stroke-opacity":"描边透明度",bootstraps1:"自展值样式1",bootstraps2:"自展值样式2",scale:"比例","leaf id":"叶节点id","font-family":"字体族名",format:"保存格式",fileName:"文件名称",save:"保存","fill-opacity":"填充透明度",bubble:"气泡",title:"标题",box:"箱",point:"点",xAxis:"X轴",yAxis:"Y轴",Grid:"网格",removeTick:"移除刻度线",Tick:"刻度",Lavel:"标签",cell:"格子",Cluster:"聚类",removePath:"移除轴线",background:"背景",bar:"柱子",switch:"开关",fan:"风扇",speed:"速度","Example data":"示例数据",view:"查看","Save drawing state":"保存绘图状态","Restore drawing state":"恢复绘图状态",significance:"显著性","Axis break":"坐标轴截断",Orientation:"方向",cluster:"聚类",Algorithm:"算法",standardization:"标准化",distance:"距离","std-direction":"标准化方向",refresh:"重刷新"},this.OpenFilePickerOptions={multiple:!1},String.prototype.replaceAll||(console.log("浏览器不支持replaceAll"),String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)}),this.fileManager=new FileManager,this.layerComponent=new LayerComponent(this),this.legendObj=new Legend(this),this.figureDataType=e,this.figureData={data:{[e]:{"select-file":{type:"file",value:"",iconClass:"cuIcon-file"},view:{type:"button",value:"",event:"viewMainData",isBGGray:!0,isFresh:!1,iconClass:"cuIcon-attentionfill"}},"Restore drawing state":{"select-file":{type:"button",value:"",event:"importOriginalJsonData",isLoading:!1,isFresh:!1,iconClass:"cuIcon-file"}},"Example data":{view:{type:"button",value:"",event:"viewEexampleData",isLoading:!1,isFresh:!1,iconClass:"cuIcon-attentionfill"}}},canvas:{"Canvas scale":{width:{type:"seq",value:800,scaleStep:1,min:100,max:1/0},height:{type:"seq",value:680,scaleStep:1,min:100,max:1/0}},Margin:{left:{type:"seq",value:140,scaleStep:1,min:-1/0,max:1/0},right:{type:"seq",value:140,scaleStep:1,min:-1/0,max:1/0},top:{type:"seq",value:60,scaleStep:1,min:-1/0,max:1/0},bottom:{type:"seq",value:60,scaleStep:1,min:-1/0,max:1/0},showMarginBox:{type:"check",value:!1}},Rotate:{switch:{type:"check",value:!1,isFresh:!0}},Zooming:{reset:{type:"button",value:"",event:"resetZooming",isFresh:!1,iconClass:"cuIcon-refresh"}}},export:{"Global font style":{switch:{type:"check",value:!1,isFresh:!0},"font-family":{type:"opt",optionList:["Times New Roman","Arial","Heiti SC"],value:0,isSvgAttr:!0}},"Save figure":{format:{type:"opt",optionList:["svg","pdf","eps","png","transparent png"],value:0,isFresh:!1},fileName:{type:"text",value:"example",isFresh:!1},save:{type:"button",value:"",event:"export",isLoading:!1,isFresh:!1,iconClass:"cuIcon-down"}},"Save drawing state":{save:{type:"button",value:"",event:"exportOriginalJsonData",isLoading:!1,isFresh:!1,iconClass:"cuIcon-down"}}}},this.svg=d3.select("#svg"),this.svg.attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink"),this.zoomG=this.svg.append("g"),this.zoom=d3.zoom().on("zoom",e=>{this.zoomG.attr("transform",e.transform)}),this.svg.call(this.zoom).call(this.zoom.transform,d3.zoomIdentity).on("dblclick.zoom",null)}init(e){console.log("init"),"changeColorBar"==e&&(this.styleData.isUseColorGradient=!0),"changeColorSet"==e&&(this.styleData.isUseColorGradient=!1);e=this.figureData.canvas["Canvas scale"];let t=this.figureData.canvas.Margin;this.marginLeft=t.left.value,this.innerwidth=e.width.value-t.left.value-t.right.value,this.innerHeight=e.height.value-t.top.value-t.bottom.value,this.svg.attr("viewBox",`0 0 ${e.width.value} ${e.height.value}`),this.svg.attr("width",e.width.value),this.svg.attr("height",e.height.value),this.maingroup=this.zoomG.append("g").attr("id","maingroup").attr("transform",e=>this.figureData.canvas.Rotate.switch.value?`rotate(90)translate(${t.top.value},-${t.left.value+this.innerHeight})`:`translate(${t.left.value},${t.top.value})`)}creatVueApp(){new FooterQRCode(this),this.getUserFigureData(`/ChiPlot/countUserVisit?plotType=${this.plotType}`);const p=this;d3.interpolateXiaoXianNv1=d3.scaleLinear().domain([0,.5,1]).range(["#81C7C1","#ffffff","#FC7956"]),d3.interpolateXiaoXianNv2=d3.scaleLinear().domain([0,.5,1]).range(["blue","white","red"]),d3.interpolateXJM1=d3.interpolateRgbBasis(["#ffffff","#ff6668"]),d3.interpolateXJM2=d3.scaleLinear().domain([0,.5,1]).range(["red","yellow","green"]),d3.interpolateXJM3=d3.interpolateRgbBasis(["#fe2340","#3dfe24"]);var e=["interpolateXiaoXianNv1","interpolateXiaoXianNv2","interpolateXJM1","interpolateXJM2","interpolateXJM3","interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral","interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds","interpolateTurbo","interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateCividis","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd","interpolateRainbow","interpolateSinebow"].map(e=>{return{name:e,dataImage:this.ramp("h",d3[e])}});this.plotType.includes("Tree")&&(this.figureData.data["Restore drawing state"]["select-file"].helpLink="https://1996xjm.github.io/tvbot/user_interface/attribute_main/data.html#restore-drawing-state",this.figureData.export["Save drawing state"].save.helpLink="https://1996xjm.github.io/tvbot/user_interface/attribute_main/export.html"),this.appData={figureData:p.figureData,controlList:[p.dictToControlList(p.figureData)],controlDataList:[p.figureData],currentIndex:0,otherControlDataList:[],hTabIndex:0,colorList:colorList,colorBarList:e,en2cnData:{},colorCount:13,colorIndex:33,isControlContainerShow:!0,navHList:["main","layer"]},this.handleClickMethods={chooseColor:function(){d3.select("#color-select").raise().transition().duration(800).style("right","0px")},export:function(){p.showYesOrNoMessageBox("Notification",`
<h6 style="text-align: center;" >If you use this image in your article, please cite our website address: <span style="color: #0d6efd">${p.plotType.includes("Tree")?"https://www.chiplot.online/tvbot.html":"https://www.chiplot.online/"}</span></h6>
<div style="display: flex;flex-direction: column;align-items: center;">
${p.plotType.includes("Tree")?"":'<img src="/static/images/gzh_qrcode.jpg" alt="" style="width: 120px;"><h6 style="text-align: center;" ><span style="color: #0d6efd">关注公众号：获取更多干货&功能更新信息</span></h6>'}


</div>
`,this.saveFigure)},chooseColorBar:function(){d3.select("#color-bar-select").raise().transition().duration(800).style("right","0px")},resetZooming:function(){p.svg.call(p.zoom).call(p.zoom.transform,d3.zoomIdentity).on("dblclick.zoom",null)},viewEexampleData:function(){window.open(`/static/xiaochiPlot/src/exampleData.html?dataUrlArr=${JSON.stringify(p.exampleDataArr)}`)},viewMainData:function(e){p.viewMainData(e)},exportOriginalJsonData:function(){p.exportOriginalJsonData()},importOriginalJsonData:function(){p.importOriginalJsonData()}},this.EventHandling={data(){return p.appData},methods:{handleClick:function(e,t){var a=e.value.event;p.handleClickMethods[a].call(this,t,e)},tabSelect:function(a){console.log(this.$parent.currentControlListIndex),this.controlList.length-1<this.$parent.currentControlListIndex||(this.controlList[this.$parent.currentControlListIndex].forEach((e,t)=>{e.isShow=t==a}),this.currentIndex=a)},hTabSelect:function(e){console.log(e),console.log(this),this.$parent.currentControlListIndex=e,this.hTabIndex=e,this.tabSelect(0)},set:function(e,t,a,o,i){if(console.log("attr:",i),"seq"==i.value.type&&(i.value.value=Number(i.value.value)),"showMarginBox"==a)return console.log(o),void(o?d3.select(`#${f}`).raise():d3.select(`#${f}`).lower());0!=i.value.isFresh&&p.init("attrChanged",a,t)},addFile:async function(e){let o=await p.fileManager.openFile(p.OpenFilePickerOptions);if(p.isLoadFileList)return console.log("self.isLoadFileList",p.isLoadFileList),void p.onLoadNewFile(o,"local");let i=[],l=[],n=!(p.originalData.mainDataArr=[]);if(1==o.length&&p.OpenFilePickerOptions.multiple&&["xlsx","xls"].includes(o[0].name.slice(o[0].name.lastIndexOf(".")+1))){n=!0;let e=await p.readExcel(o[0],n);o=e.map(e=>({name:e.sheetName,d3Data:e.d3Data}))}for(let t=0;t<o.length;t++){let a=n?o[t].d3Data:await p.creatD3Data(o[t]);if(console.log("d3_data",a),a.columns)for(let t=0;t<a.length;t++){let e=0;var r,s=a.length-t-1;for(r in a[s])null==a[s][r]&&e++;e==a.columns.length&&(a.splice(s,1),p.showMessageBox("cuIcon-roundclose","Table contains blank rows which have been deleted!","warning"))}let e=o[t].name.slice(0,-1==o[t].name.lastIndexOf(".")?void 0:o[t].name.lastIndexOf("."));var c={fileName:e,type:a.columns?"tsvStr":"object"==typeof a?"xml":"treefile",fileData:a.columns?d3.tsvFormat(a,a.columns):"object"==typeof a?(new XMLSerializer).serializeToString(a):a};p.originalData.mainDataArr.push(c),i.push(a),l.push(e.replaceAll("&","_"))}p.OpenFilePickerOptions.multiple?p.onLoadNewFile(i,"local",l):p.onLoadNewFile(i[0],"local",l[0]),this.figureData.data[p.figureDataType].view.isBGGray=!1},saveFigure:function(){var e=p.figureData.export["Save figure"].format.optionList[p.figureData.export["Save figure"].format.value],t=a=>{console.log("png"),this.figureData.export["Save figure"].save.isLoading=!0,axios.post(`/svg2others?format=${a}&plotType=${p.plotType}`,document.getElementById("svg").outerHTML.replaceAll("&nbsp;"," "),{responseType:"blob"}).then(e=>{console.log(e),this.figureData.export["Save figure"].save.isLoading=!1;var t=new FileReader;t.readAsDataURL(e.data),t.onload=function(e){let t=document.createElement("a");t.href=e.target.result,t.download=`${p.figureData.export["Save figure"].fileName.value}.${"transparent png"==a?"png":a}`,t.click()}}).catch(e=>{this.figureData.export["Save figure"].save.isLoading=!1;var{status:t,statusText:a}=e.response;p.showMessageBox("cuIcon-roundclose",`${t}:${a},请联系作者解决！`,"error"),console.log(e)})};if("svg"==e){var a=new Blob([p.svg.node().outerHTML.replaceAll("&nbsp;"," ")],{type:"image/svg+xml;charset=utf-8"});let e=window.URL||window.webkitURL||window;a=e.createObjectURL(a);let t=document.createElement("a");t.href=a,t.download=`${p.figureData.export["Save figure"].fileName.value}.svg`,t.click(),e.revokeObjectURL(a)}else t(e)},hideColorSelecter:function(){d3.select("#color-select").transition().duration(800).style("right",`-${38*this.colorCount}px`)},hideColorBarSelecter:function(){d3.select("#color-bar-select").transition().duration(800).style("right","-300px")},changeColorSet:function(e,t){this.colorIndex=e,0==this.$parent.currentControlListIndex?(p.styleData.currentColorList=this.colorList[e].colorSet,p.styleData.isUseColorGradient=!1):(p.Vue.$data.layerStatistic&&p.currentLayerType&&(console.log("self.Vue.$data.layerStatistic",p.Vue.$data.layerStatistic),p.Vue.$data.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].categoryColorList=this.colorList[e].colorSet,p.Vue.$data.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].isUseColorGradient=!1),p.layerPlaneData&&(p.layerPlaneData.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].categoryColorList=this.colorList[e].colorSet,p.layerPlaneData.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].isUseColorGradient=!1)),p.init("changeColorSet"),d3.select("#color-select").selectAll("input").each(function(){let e=d3.select(this);e.node()!=t.target&&(e.node().checked=!1)})},changeColorBar:function(e,t){0==this.$parent.currentControlListIndex?(p.styleData.currentColorInterpolate=e,p.styleData.isUseColorGradient=!0):(p.Vue.$data.layerStatistic&&p.currentLayerType&&(p.Vue.$data.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].colorInterpolate=e,p.Vue.$data.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].isUseColorGradient=!0),p.layerPlaneData&&(p.layerPlaneData.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].colorInterpolate=e,p.layerPlaneData.layerStatistic[p.currentLayerType][p.currentLayerStatisticIndex].isUseColorGradient=!0)),p.init("changeColorBar"),d3.select("#color-bar-select").selectAll("input").each(function(){let e=d3.select(this);e.node()!=t.target&&(e.node().checked=!1)})},changeLanguage:function(e){this.en2cnData=e.target.checked?p.en2cnData:{}},hideControlContainer:function(){this.isControlContainerShow?(console.log("90"),d3.select("#control-container").transition().duration(400).style("min-width","30px").style("max-width","30px").style("height","30px")):d3.select("#control-container").transition().duration(400).style("min-width","350px").style("max-width","450px").style("height","inherit"),this.isControlContainerShow=!this.isControlContainerShow},dragScaleValue:function(e,t,a,o,i,l){console.log(e,t,a,o,i,l);const n=this;let r=(e="touchstart"==e.type?e.touches[0]:e).clientX,s=function(e){if(e.preventDefault(),(e="touchmove"==e.type?e.touches[0]:e).clientX>r){if(a.value>=a.max)return void(a.value=a.max);if(a.scaleStep)try{a.value=a.value+a.scaleStep,console.log(a.value),console.log(a.scaleStep)}catch(e){console.log("num parse err")}}if(e.clientX<r){if(a.value<=a.min)return void(a.value=a.min);if(a.scaleStep)try{a.value=Number(a.value)-Number(a.scaleStep),console.log(a.value)}catch(e){console.log("num parse err")}}r=e.clientX,"string"==typeof t&&a.isSvgAttr&&d3.selectAll(`.${t}`).call(e=>{p.renderAttr(e,p.appData.controlDataList[n.$parent.currentControlListIndex][o][i])})};document.addEventListener("touchmove",s);document.onmousemove=s,document.onmouseup=function(){document.onmousemove=null,console.log("mouseup"),"string"==typeof t&&a.isSvgAttr||p.init(),document.onmouseup=null};let c=function(){console.log("touchend"),"string"==typeof t&&a.isSvgAttr||p.init(),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",c)};document.addEventListener("touchend",c)},addControlTab:function(e,t,a){this.navHList=[...this.navHList.slice(0,-1),e,"layer"],this.controlList[this.navHList.length-2]=p.dictToControlList(t),p.appData.controlDataList[this.navHList.length-2]=t,p.appData.otherControlDataList.push({key:a,controlData:t})}},template:controlPlane_T,props:["cindex"]};let f="app2";this.EventHandling1={data(){return{message:"Hello Vue!",width:p.figureData.canvas["Canvas scale"].width,height:p.figureData.canvas["Canvas scale"].height,marginTop:p.figureData.canvas.Margin.top,marginBottom:p.figureData.canvas.Margin.bottom,marginLeft:p.figureData.canvas.Margin.left,marginRight:p.figureData.canvas.Margin.right,showMarginBox:p.figureData.canvas.Margin.showMarginBox,isScaleMouseOn:!1,isMarginMouseOn:!1,isMoving:!1}},methods:{dragEagle:function(e,o){e.preventDefault();var t=e.type;"touchstart"==t&&(e=e.touches[0]);var i=document.getElementById("eagleMapContainer"),l=i.offsetWidth,n=i.offsetHeight,r=e.clientX,s=e.clientY,c=this;let d=this.marginRight.value,u=this.marginBottom.value,a=function(e){e.preventDefault(),"touchmove"==e.type&&(e=e.touches[0]),c.isMoving=!0;var t=Math.abs(e.clientX-r),a=Math.abs(e.clientY-s);e.clientX>r&&parseInt(i.style.width)<=window.innerWidth-100&&(0==o||3==o)&&(c.width.value=l+t,c.marginRight.value=d+t,console.log("右")),e.clientX<r&&400<=parseInt(i.style.width)&&(0==o||3==o)&&(c.width.value=l-t,c.marginRight.value=d-t,console.log("左")),e.clientY>s&&(1==o||3==o)&&(c.height.value=n+a,c.marginBottom.value=u+a),e.clientY<s&&400<=parseInt(i.style.height)&&(1==o||3==o)&&(c.height.value=n-a,c.marginBottom.value=u-a)},h=function(e){p.init(),c.showMarginBox.value||d3.select(`#${f}`).lower(),c.isMoving=!1,c.isScaleMouseOn=!1,document.removeEventListener("touchmove",a),document.removeEventListener("touchend",h)};"mousedown"==t?(document.onmousemove=a,document.onmouseup=function(e){p.init(),c.showMarginBox.value||d3.select(`#${f}`).lower(),c.isMoving=!1,c.isScaleMouseOn=!1,document.onmousemove=null,document.onmouseup=null}):(document.addEventListener("touchmove",a),document.addEventListener("touchend",h))},marginEagle:function(e,o){let t=this;t.isMarginMouseOn=!0;var a=e.type;e.preventDefault(),"touchstart"==a&&(e=e.touches[0]);var i=document.getElementById("margin-box"),l=(i.offsetWidth,i.offsetHeight,e.clientX),n=e.clientY,r=this;let s=this.marginRight.value,c=this.marginLeft.value,d=this.marginTop.value,u=this.marginBottom.value,h=function(e){console.log("move"),e.preventDefault(),"touchmove"==e.type&&(e=e.touches[0]);var t=Math.abs(e.clientX-l),a=Math.abs(e.clientY-n);e.clientX>l&&(0==o&&10<r.marginRight.value&&(r.marginRight.value=s-t),1==o&&60<parseInt(i.style.width)&&(r.marginLeft.value=c+t),console.log("右")),e.clientX<l&&(0==o&&60<parseInt(i.style.width)&&(r.marginRight.value=s+t),1==o&&10<r.marginLeft.value&&(r.marginLeft.value=c-t),console.log("左")),e.clientY>n&&(2==o&&60<parseInt(i.style.height)&&(r.marginTop.value=d+a),3==o&&10<r.marginBottom.value&&(r.marginBottom.value=u-a)),e.clientY<n&&(2==o&&10<r.marginTop.value&&(r.marginTop.value=d-a),3==o&&60<parseInt(i.style.height)&&(r.marginBottom.value=u+a))},f=function(e){p.init(),t.isMarginMouseOn=!1,document.removeEventListener("touchmove",h),document.removeEventListener("touchend",f)};"mousedown"==a?(document.onmousemove=h,document.onmouseup=function(){document.onmousemove=null,t.isMarginMouseOn=!1,p.init(),document.onmouseup=null}):(document.addEventListener("touchmove",h),document.addEventListener("touchend",f))},showScaleBox:function(e){0==e?this.isScaleMouseOn=!0:this.isMarginMouseOn=!0,d3.select(`#${f}`).raise()},hideScaleBox:function(e){this.isMoving||(0==e?this.isScaleMouseOn=!1:this.isMarginMouseOn=!1,this.showMarginBox.value||d3.select(`#${f}`).lower())}},template:eagleMapContainer_T,props:["toggle"]};let t=Vue.createApp({}).component("svg-resizebox",this.EventHandling1).mount("#app2");this.marginDragApp=t,this.Vue=Vue.createApp({data(){return{currentControlListIndex:0}}}).component("control-plane",this.EventHandling).component("layer-plane",this.layerComponent.createVUELayerComponent()).mount("#app"),this.layerPlaneData=this.Vue.$refs.layerPlane.$data,d3.select("body").node().ondblclick=function(e){console.log(e),[d3.select("body").node(),d3.select("#margin-box").node(),p.svg.node(),d3.select("#eagleMapContainer").node()].includes(e.target)&&(e.preventDefault(),p.svg.call(p.zoom).call(p.zoom.transform,d3.zoomIdentity).on("dblclick.zoom",null),t.$refs.svgResizebox.$data.showMarginBox.value=!t.$refs.svgResizebox.$data.showMarginBox.value,t.$refs.svgResizebox.$data.showMarginBox.value?d3.select("#app2").raise():d3.select("#app2").lower())},["networkPlot","groupErrorLinePlot","groupErrorBarPlot","groupBoxPlot"].includes(this.plotType)&&this.showYesOrNoMessageBox("功能更新提示",`
<h6 style="text-align: center;" >数据文件支持仅导入一个带多sheet的Excel文件啦</h6>
<a href="https://www.bilibili.com/video/BV1ja41187NQ/" target="_blank">点击观看详细演示视频</a>
`)}setExampleData(e=[]){this.exampleDataArr=e}dictToControlList(l){console.log("dict",l);let t=[],n={seq:"text",text:"text",color:"color",opt:"select",file:"file",button:"button",check:"checkbox"},e=Object.keys(l);return e.includes("export")&&(e.splice(e.indexOf("export"),1),e.push("export")),e.forEach((o,e)=>{let i={isShow:0==e,tabName:o,attrTypeList:[]};Object.keys(l[o]).forEach(t=>{let a={type:t,attrList:[]};i.attrTypeList.push(a),Object.keys(l[o][t]).forEach(e=>{e={attrName:e,nodeType:n[l[o][t][e].type],optionList:"opt"==l[o][t][e].type?l[o][t][e].optionList:[],value:l[o][t][e]};a.attrList.push(e)})}),t.push(i)}),t}handleCustomStyleValue(e,t,a="color"){let o={switch:{type:"check",value:!1,isFresh:!0}};for(var i in"pattern"==a&&delete o.switch,t.forEach(e=>{switch(a){case"color":o[e]={type:"color",value:"#cccccc",isSvgAttr:!0};break;case"shape":o[e]={type:"opt",optionList:["BaGua","ironMan","spiderMan","captainShield","symbolCircle-fill","symbolCircle-nofill","symbolCross-fill","symbolCross-nofill","symbolDiamond-fill","symbolDiamond-nofill","symbolSquare-fill","symbolSquare-nofill","symbolStar-fill","symbolStar-nofill","symbolTriangle-fill","symbolTriangle-nofill","symbolWye-fill","symbolWye-nofill","symbolDownTriangle-fill","symbolDownTriangle-nofill","symbolDiamond2-fill","symbolDiamond2-nofill","symbolAsterisk-nofill","symbolPlus-nofill","symbolX-nofill"],value:4,isSvgAttr:!1};break;case"pattern":o[e]={type:"opt",optionList:["None",...this.patternsSVGArr.map(e=>e.name)],value:0,isSvgAttr:!0}}}),e)i in o&&(o[i].value=e[i].value);return o}createDom(){d3.select("body").append("div").attr("id","message-box").call(e=>{e.append("div").attr("id","message-icon-box").style("font-size","30px"),e.append("div").attr("id","message-text-box").style("font-size","20px")})}viewMainData(e){if(0==this.originalData.mainDataArr.length)return this.showMessageBox("cuIcon-roundclose","No user data!","error"),void this.shakeElement(e);window.localStorage.setItem("mainDataArr",JSON.stringify(this.originalData.mainDataArr)),window.open("/static/xiaochiPlot/src/exampleData.html?type=localStorage&source=mainDataArr"),console.log("viewMainData")}exportOriginalJsonData(e=!1){if(console.log(this.Vue.$data),0==this.originalData.mainDataArr.length){let e="No user data!";return this.plotType.includes("Tree")&&(e="Please import a tree file!"),void this.showMessageBox("cuIcon-roundclose",e,"error")}let a={plotType:this.plotType,date:(new Date).toLocaleString(),originalData:this.originalData,styleData:this.styleData,figureData:this.figureData,otherControlDataList:this.appData.otherControlDataList,webSiteUrl:window.location.pathname,layer:{layerStatistic:{},layerList:[]}};if(this.layerPlaneData.layerStatistic){var t,o=this.layerPlaneData.layerStatistic,i=this.layerPlaneData.layerList;for(t in o)a.layer.layerStatistic[t]=o[t];a.layer.layerList=i,console.log("this.layerPlaneData.layerDataFlieList",this.layerPlaneData.layerDataFlieList),a.originalData.metaDataArr=[],this.layerPlaneData.layerDataFlieList.forEach(e=>{var t=this.layerDataDict[e.fileKey].dataSource,t={fileName:e.fileName,fileType:t.columns?"tsvStr":"text",fileKey:e.fileKey,fileData:t.columns?d3.tsvFormat(t,t.columns):t};a.originalData.metaDataArr.push(t)})}if(console.log(a),e)return a;e=new Blob([JSON.stringify(a)],{type:"application/json;charset=utf-8"});let l=window.URL||window.webkitURL||window;e=l.createObjectURL(e);let n=document.createElement("a");n.href=e,n.download=`${this.plotType}.json`,n.click(),l.revokeObjectURL(e)}async importOriginalJsonData(i){var e;if(null==i&&(e=await this.fileManager.openFile({multiple:!1,types:[{description:"json",accept:{"application/json":[".json"]}}]}),i=await this.creatD3Data(e[0])),console.log(i),i.plotType==this.plotType){for(var l in this.styleData={},i.styleData)this.styleData[l]=i.styleData[l];let t=[],a=[];i.originalData.mainDataArr.forEach(e=>{"tsvStr"==e.type?t.push(d3.tsvParse(e.fileData,d3.autoType)):"xml"==e.type?t.push((new DOMParser).parseFromString(e.fileData,"text/xml")):t.push(e.fileData),a.push(e.fileName)}),i.otherControlDataList&&i.otherControlDataList.forEach((e,t)=>{this.updateControlData(e.controlData,this[e.key]),this.Vue.$refs.controlPlane.$data.controlList[t+1]=this.dictToControlList(this[e.key]),this.Vue.$refs.controlPlane.$data.controlDataList[t+1]=this[e.key]}),console.log(this.figureData),this.Vue.$refs.controlPlane.$data.controlList[0]=this.dictToControlList(this.figureData),this.Vue.$refs.controlPlane.$data.controlDataList[0]=this.figureData,this.marginDragApp.$refs.svgResizebox.$forceUpdate(),this.originalData.mainDataArr=i.originalData.mainDataArr,this.Vue.$refs.controlPlane.$data.figureData.data[this.figureDataType].view.isBGGray=!1;let e=void 0;e=this.OpenFilePickerOptions.multiple?this.onLoadNewFile(t,"originalJsonData",a):this.onLoadNewFile(t[0],"originalJsonData",a[0]),console.log("加载原始数据",e),e&&e.then?e.then(e=>{this.updateControlData(i.figureData,this.figureData),this.init("originalJsonData")}):(this.updateControlData(i.figureData,this.figureData),this.init("originalJsonData")),this.layerPlaneData.layerDataFlieList=[],this.layerDataDict={},console.log("metaDataArr",i.originalData.metaDataArr),i.originalData.metaDataArr.forEach(e=>{var t=d3.tsvParse(e.fileData,d3.autoType);this.Vue.$refs.layerPlane.handleLayerDataFile(t,e.fileName,void 0)}),this.layerPlaneData.layerStatistic={},this.layerPlaneData.layerList=[];let o={normalTree:{"text label":"text map","text label with category":"text map with category"}};i.layer.layerList.forEach(e=>{var t=i.layer.layerStatistic[e.layerType][e.layerStatisticIndex];i.plotType in o&&e.layerType in o[i.plotType]&&(e.layerType=o[i.plotType][e.layerType]),this.Vue.$refs.layerPlane.addDataLyerSubmit(null,t,e)})}else this.showMessageBox("cuIcon-roundclose","Plot type error!","error")}updateControlData(e,t){for(var a in e)if(t[a])for(var o in e[a])if(t[a][o])for(var i in e[a][o])if("string"!=typeof e[a][o][i])if(t[a][o][i])for(var l in e[a][o][i]){var n=e[a][o][i][l];"value"==l&&(t[a][o][i][l]=n)}else console.log("当前控制数据没有这个key",i)}ramp(a="v",o=d3.interpolateBrBG,i=256,l=!1){const e=document.createElement("canvas");"v"==a?(e.width=1,e.height=i):(e.width=i,e.height=1);const n=e.getContext("2d");for(let t=0;t<i;++t){let e=t;l&&(e=i-t-1),n.fillStyle=o(e/(i-1)),"v"==a?n.fillRect(0,t,1,1):n.fillRect(t,0,1,1)}return e.toDataURL()}renderAttr(t,a){Object.keys(a).forEach(e=>{if(a[e].isSvgAttr)switch(e){case"rotate":t.attr("transform",`rotate(${a.rotate.value})`);break;case"text":console.log("legend",a[e]),t.text(a[e].value);break;default:"opt"==a[e].type?t.attr(e,a[e].optionList[a[e].value]):t.attr(e,a[e].value)}})}renderText(e,t){e.text("");let a=t,o=a.match(/<su[pb]>.*?<\/su[pb]>/g);var i=a.split(/<su[pb]>.*?<\/su[pb]>/g);let l=[];for(let e=0;e<i.length&&(i[e]&&l.push({value:i[e],type:"normal"}),e!=i.length-1);e++)o[e].startsWith("<sup>")?l.push({value:o[e].slice(5,-6),type:"superscript"}):o[e].startsWith("<sub>")&&l.push({value:o[e].slice(5,-6),type:"subscript"});let n=e.selectAll("tspan").data(l).join("tspan").text(e=>e.value);n.filter(e=>"superscript"==e.type).attr("baseline-shift","super").attr("font-size","0.8em"),n.filter(e=>"subscript"==e.type).attr("baseline-shift","sub").attr("font-size","0.8em")}valueFormat(e,o){(o=o.trim()).endsWith("E")?(e.text(""),e.append("tspan").text(e=>{var t=d3.format(o.replace("E","e"))(e).split("e"),a=Number(t[0]),e=Number(t[1]);return 0==a||0==e?t[0]:1==a?"10":t[0]+" x 10"}),e.append("tspan").text(e=>{let t=d3.format(o.replace("E","e"))(e).split("e");var a=Number(t[0]),e=Number(t[1]);return 0==a||0==e?"":t[1].replace("+","")}).attr("baseline-shift","super").attr("font-size","0.8em")):e.text(e=>d3.format(o)(e))}setGlobalFontStyle(){var e;console.log(34),this.zoomG.selectAll("text").each(function(){let e=d3.select(this);0<=escape(e.text()).indexOf("%u")&&e.attr("font-family","Heiti SC")}).attr("xml:space","preserve"),this.figureData.export["Global font style"].switch.value&&(e=this.figureData.export["Global font style"]["font-family"],this.zoomG.selectAll("text").attr("font-family",e.optionList[e.value]))}drag({enableX:a=!0,enableY:o=!0}={}){const e=this;return d3.drag().on("start",function(){d3.select(this).raise().classed("stroke-orange",!0)}).on("drag",function(e,t){d3.select(this).attr("transform",`translate(${t.x=(a?e:t).x},${t.y=(o?e:t).y})`)}).on("end",function(){d3.select(this).attr("stroke",null),d3.select(this).raise().classed("stroke-orange",!1),console.log(e.btDragData)})}copyText(e,t){var a=document.createElement("textarea");a.setAttribute("id","cp_hgz_input"),a.value=e,document.getElementsByTagName("body")[0].appendChild(a),document.getElementById("cp_hgz_input").select(),document.execCommand("copy"),document.getElementById("cp_hgz_input").remove(),t&&t(e)}readExcel(o,i=!1){return new Promise((t,e)=>{let a=new FileReader;a.onload=function(e){e=e.target.result;let a=XLSX.read(e,{type:"binary"});console.log("excel-book",a);let o=[];a.SheetNames.forEach(e=>{let t=XLSX.utils.sheet_to_csv(a.Sheets[e]);t.startsWith(",")&&(t="sample_id"+t),t=t.replace(/(,+)(\n)/g,"$2"),t=t.replace(/\n+$/g,"\n"),o.push({sheetName:e,d3Data:d3.csvParse(t,d3.autoType)})}),t(i?o:o[0].d3Data)},a.readAsBinaryString(o)})}creatD3Data(e){console.log(e);let t=null;var a=window.webkitURL.createObjectURL(e);switch(e.name.slice(e.name.lastIndexOf(".")+1).toLowerCase()){case"tsv":t=d3.tsv(a,d3.autoType);break;case"csv":t=d3.csv(a,d3.autoType);break;case"json":t=d3.json(a);break;case"xml":t=d3.xml(a);break;case"xlsx":case"xls":t=this.readExcel(e);break;default:t=d3.text(a)}return t}uploadUserData(a,o,i){return new Promise((t,e)=>{axios.post("/ChiPlot/uploadUserData",JSON.stringify({tsvData:a,uid:o,fileName:i})).then(e=>{t(e),console.log(e)}).catch(function(e){console.log(e)})})}getUserFigureData(a){return a=a.replaceAll("+","%2B"),new Promise((t,e)=>{axios.get(a).then(e=>{console.log(e),t(e.data)}).catch(e=>{console.log(e.response);let{status:t,statusText:a}=e.response;502==t&&(a="服务器错误"),this.showMessageBox("cuIcon-roundclose",`${t}:${a},请联系作者解决！`,"error")})})}getMaxMinValue(o,e){console.log(o);let i=[],t=e||o.columns.slice(1);return t.forEach((t,e)=>{var a=d3.extent(o,e=>e[t]);i=i.concat(a)}),[Math.min(...i),Math.max(...i)]}getAxisControlData(e,t="x",a){let o={Axis:{switch:{type:"check",value:!0,isFresh:!0},"position-type":{type:"opt",optionList:"x"==t?["top","bottom"]:["left","right"],value:0,isSvgAttr:!1},offset:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}},"Text style":{id:`${t}Axis-tick-text-${e}`,switch:{type:"check",value:!0,isFresh:!0},rotate:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},offset:{type:"seq",value:-15,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}},Tick:{stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},tickValues:{type:"text",value:"",isSvgAttr:!0,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html#tickvalues"},tickFormat:{type:"text",value:"",isSvgAttr:!0,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"},removePath:{type:"check",value:!1,isFresh:!0},removeTick:{type:"check",value:!1,isFresh:!0}},Grid:{id:`${t}Axis-grid-line-${e}`,switch:{type:"check",value:!1,isFresh:!0},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-dasharray":{type:"text",value:"",isSvgAttr:!0},"stroke-opacity":{type:"seq",value:.1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},Label:{id:`${t}Axis-label-${e}`,text:{type:"text",value:"",isSvgAttr:!0},rotate:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:-30,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0}}};return"circleTree"==self.plotType&&(o.Label.y.isSvgAttr=!1),"normalTree"==self.plotType&&delete o.Label.rotate,a?a(o):o}getMaxMinValueAbs(o,e){console.log(o);let i=[],t=e||o.columns.slice(1);return t.forEach((t,e)=>{var a=d3.extent(o,e=>Math.abs(e[t]));i=i.concat(a)}),[Math.min(...i),Math.max(...i)]}parseNewick(e){for(var t=[],a={},o=e.split(/\s*(;|\(|\)|,|:)\s*/),i=0;i<o.length;i++){var l=o[i];switch(l){case"(":var n={};a.children=[n],t.push(a),a=n;break;case",":n={};t[t.length-1].children.push(n),a=n;break;case")":a=t.pop();break;case":":break;default:var r=o[i-1];")"==r||"("==r||","==r?a.name=l:":"==r&&(a.length=parseFloat(l))}}return a}newickParser(t,e={}){const o=/^-?\d+(\.\d+)?$/;let i=e.left_delimiter||"{",a=e.right_delimiter||"}",l=[];function n(){let e=l[l.length-1];"children"in e||(e.children=[]),l.push({name:null}),e.children.push(l[l.length-1]),l[l.length-1].original_child_order=e.children.length}function r(e){return{json:null,error:"Unexpected '"+t[e]+"' in '"+t.substring(e-20,e+1)+"[ERROR HERE]"+t.substring(e+1,e+20)+"'"}}let s=0,c="",d="",u="",h=null;var f={"'":1,'"':1},e={name:"root"};l.push(e);for(var p=/\s/,g=0;g<t.length;g++)try{var m=t[g];switch(s){case 0:"("==m&&(n(),s=1);break;case 1:case 3:if(":"==m)s=3;else if(","==m||")"==m)try{!function(){let a=l.pop();a.name=c,"children"in a?a.bootstrap_values=c:a.name=c,a.attribute=d,a.length=parseFloat(d),"["==i&&u.includes("&&NHX")?u.split(":").slice(1).forEach(e=>{var[t,e]=e.split("=");a[t]=o.test(e)?+e:e}):a.annotation=u,c="",d="",u=""}(),s=1,","==m&&n()}catch(e){return r(g)}else if("("==m){if(0<c.length)return r(g);n()}else{if(m in f){if(1!=s||0!==c.length||0!==d.length||0!==u.length)return r(g);s=2,h=m;continue}if(m==i){if(u.length)return r(g);s=4}else if(3==s)d+=m;else{if(p.test(m))continue;if(";"==m){g=t.length;break}c+=m}}break;case 2:if(m==h){if(g<t.length-1&&t[g+1]==h){g++,c+=h;continue}h=0,s=1;continue}c+=m;break;case 4:if(m==a)s=3;else{if(m==i)return r(g);u+=m}}}catch(e){return r(g)}return 1!=l.length?r(t.length-1):{json:e,error:null}}shakeElement(e){d3.select(e.target).classed("animation-shake",!0),setTimeout(()=>{d3.select(e.target).classed("animation-shake",!1)},1e3)}showYesOrNoMessageBox(e,t,a,o){this.layerPlaneData.isYesOrNoMessageBoxShow=!0,this.layerPlaneData.isShowModal=!0,d3.select("#yes-or-no-message-box").style("top","-300px").transition().ease(d3.easeQuadInOut).duration(400).style("top","200px"),this.layerPlaneData.YesOrNoMessageObj={title:e,content:t,yesFun:e=>{a&&a(),this.Vue.$refs.layerPlane.hideYesOrNoMessageBox()}}}showMessageBox(e="cuIcon-roundcheck",t="successful",a="success"){console.log(e),d3.select("#message-text-box").text(t),d3.select("#message-icon-box").classed(e,!0),d3.select("#message-box").style("opacity",1).style("background-color",e=>"success"==a?"var(--bs-orange)":"error"==a?"var(--red)":"warning"==a?"#ebc700":void 0).transition().ease(d3.easeBounceOut).duration(600).style("top","10px").transition().ease(d3.easeCubicIn).duration(4e3).style("opacity",0).transition().duration(100).style("top","-80px").on("end",()=>{d3.select("#message-icon-box").classed(e,!1)})}}export{MainPlot};